### Chapter 5 網路虛擬化

網路虛擬化 (Network Virtualization, NV) 是一項革命性技術，它將網路資源從底層硬體中抽象出來，使其能夠以軟體形式進行管理、分配和操作。這使得網路基礎設施能夠像伺服器虛擬化一樣，變得更加靈活、可擴展且成本效益更高。本章將深入探討網路虛擬化的核心概念、典型實踐與其對現代網路架構的影響。

-----

### 5.1 核心概念與定義

#### 5.1.1 什麼是網路虛擬化？

**定義：** 網路虛擬化是一種將網路資源（如頻寬、交換器、路由器、防火牆等）從其物理硬體中解耦的技術。它允許網路營運商和企業創建邏輯上獨立的虛擬網路，這些虛擬網路可以在共享的物理基礎設施上運行，並根據需求進行配置和管理。每個虛擬網路都擁有自己獨立的控制平面、資料平面、路由表和安全策略，對應用程式和使用者而言，它們如同運行在專屬的物理網路上。

**核心觀念：**
*   **資源抽象化 (Resource Abstraction)：** 將底層物理網路設備的複雜性隱藏起來，向上層應用提供簡化的邏輯視圖。
*   **資源池化 (Resource Pooling)：** 將分散的網路資源匯集起來，形成一個可動態分配的資源池。
*   **隔離性 (Isolation)：** 不同的虛擬網路之間相互隔離，互不影響，確保安全性與效能。
*   **可程式化 (Programmability)：** 允許透過軟體介面動態配置、修改和管理網路。

**例子：** 想像一個大型數據中心有多個客戶。傳統上，每個客戶可能需要購買自己的交換器、路由器和防火牆。透過網路虛擬化，數據中心可以建立多個虛擬網路，每個虛擬網路都為一個客戶服務，這些虛擬網路共用數據中心內的實體網路設備，但邏輯上彼此獨立。

#### 5.1.2 虛擬網路的構成要素

虛擬網路通常由一系列虛擬化的網路設備組成，它們在功能上模仿實體設備：

*   **虛擬交換器 (Virtual Switch, vSwitch)：**
    *   **定義：** 運行在伺服器虛擬化管理程式 (Hypervisor) 或作業系統內部的軟體程式，用於在同一台物理伺服器上的虛擬機器 (VMs) 之間，以及 VMs 與物理網路之間轉發流量。
    *   **例子：** VMware vSwitch, Open vSwitch (OVS)。
    *   **關聯：** 它是連接虛擬機器到網路的橋樑，類似於物理交換器在實體環境中的作用。
*   **虛擬路由器 (Virtual Router, vRouter)：**
    *   **定義：** 實現路由器功能的軟體實例，能夠在不同的虛擬子網路或虛擬私有雲 (VPC) 之間進行路由選擇和轉發。
    *   **例子：** 運行在 VM 中的路由軟體，或 OpenStack Neutron 中的路由服務。
    *   **關聯：** 提供虛擬網路之間的連通性，是虛擬環境中的網路閘道。
*   **虛擬防火牆 (Virtual Firewall, vFirewall)：**
    *   **定義：** 以軟體形式運行，提供網路安全保護功能的虛擬設備，能夠過濾流量、執行訪問控制列表 (ACLs) 和入侵檢測。
    *   **例子：** 在 VM 或容器中部署的防火牆軟體，如 pfSense, OPNsense, 或商用網路安全廠商提供的虛擬設備。
    *   **關聯：** 提供虛擬網路的邊界安全，是實體防火牆的軟體化替代品。
*   **虛擬網路介面卡 (Virtual Network Interface Card, vNIC)：**
    *   **定義：** 附加到虛擬機器或容器上的軟體介面，使其能夠連接到虛擬交換器並進行網路通訊。
    *   **例子：** 每一個虛擬機器都會配置一個或多個 vNIC。
    *   **關聯：** 是虛擬機器與網路通訊的端點，對應於實體伺服器上的物理網卡。

#### 5.1.3 軟體定義網路 (SDN) 與網路功能虛擬化 (NFV) 簡介

SDN 和 NFV 是網路虛擬化的兩大關鍵驅動技術，它們常常協同工作：

*   **軟體定義網路 (Software-Defined Networking, SDN)：**
    *   **定義：** 一種網路架構方法，它將網路的控制平面 (Control Plane) 與資料平面 (Data Plane) 分離。控制平面由中央控制器集中管理，負責決定流量的路徑；資料平面由底層網路設備 (如交換器、路由器) 負責執行流量轉發。
    *   **核心觀念：** 集中式控制、網路可程式化、開放介面。
    *   **例子：** SDN 控制器可以透過 OpenFlow 協定，動態地編程交換器的轉發表，實現靈活的流量工程。
    *   **關聯：** SDN 提供了集中式的網路控制能力，是實現網路虛擬化中靈活組網和策略管理的關鍵。

*   **網路功能虛擬化 (Network Functions Virtualization, NFV)：**
    *   **定義：** 一種將傳統上運行在專用硬體設備上的網路功能（如防火牆、負載平衡器、入侵檢測系統等）解耦，作為虛擬網路功能 (Virtual Network Functions, VNFs) 運行在通用伺服器 (Commercial Off-The-Shelf, COTS) 上的技術。
    *   **核心觀念：** 軟體化、通用硬體、彈性擴展。
    *   **例子：** 將一個物理防火牆替換為運行在虛擬機器或容器中的虛擬防火牆軟體。
    *   **關聯：** NFV 提供了虛擬網路中功能模組的軟體化實現，使網路部署和擴展更加靈活，降低硬體成本。

#### 5.1.4 控制平面與資料平面分離

**定義：** 這是 SDN 的核心原則。
*   **控制平面 (Control Plane)：** 負責網路的智慧，例如路由協定、拓撲發現、安全策略制定、資源管理等。它決定了資料包的轉發路徑。
*   **資料平面 (Data Plane / Forwarding Plane)：** 負責實際的資料包轉發。網路設備根據控制平面下發的指令（如轉發表規則）快速轉發資料包。

**例子：** 在傳統網路中，交換器和路由器各自運行其控制平面（如 OSPF/BGP 路由協定）和資料平面。在 SDN 中，所有網路設備的控制平面功能被抽離到一個中央控制器，控制器統一計算路徑並下發規則給設備的資料平面執行。

**推導/優勢：**
$$
\text{SDN 網路架構} = \text{集中式控制平面} + \text{分散式資料平面}
$$
這種分離帶來了：
1.  **集中管理：** 從單一視點控制整個網路，簡化管理。
2.  **可程式化：** 透過標準 API，應用程式可以直接控制網路行為。
3.  **靈活性：** 快速部署新服務和修改網路策略。
4.  **創新：** 鼓勵新的網路應用和服務的開發。

-----

### 5.2 典型例子與運作模式

#### 5.2.1 SDN 運作模式

SDN 透過集中式控制器來管理底層網路設備，實現網路的彈性控制和可程式化。

*   **OpenFlow 協定簡介：**
    *   **定義：** 一種開放的通訊協定，定義了 SDN 控制器如何與底層交換機的資料平面進行溝通，以編程其轉發表。它允許控制器對交換機的流量進行細粒度控制。
    *   **核心觀念：** 流表 (Flow Table)、匹配動作 (Match-Action)。當資料包進入 OpenFlow 交換機時，它會根據流表中的規則進行匹配，如果匹配成功，則執行相應的動作（如轉發到特定埠、丟棄、修改標頭等）。
    *   **例子：** 控制器可以指示交換器，將所有源 IP 為 192.168.1.100 的流量導向埠 5，而將所有目的 IP 為 10.0.0.5 的流量導向埠 8。

*   **SDN 控制器 (SDN Controller) 的角色：**
    *   **定義：** SDN 架構中的「大腦」，負責收集網路拓撲資訊、計算流量路徑、制定安全策略，並將這些決策轉換為底層設備可以理解的指令 (例如 OpenFlow 規則)，然後下發給網路設備。
    *   **例子：** ONOS, OpenDaylight (ODL), Ryu 等。
    *   **關聯：** 控制器是 SDN 網路的核心，它向上提供抽象的 API 供應用程式使用，向下透過南向介面 (Southbound Interface) 控制網路設備。

#### 5.2.2 NFV 運作模式

NFV 將網路功能從專用硬體中解耦，運行在通用伺服器上，實現更低的成本和更高的靈活性。

*   **虛擬網路功能 (Virtual Network Function, VNF)：**
    *   **定義：** 傳統上運行在專用硬體上的網路功能（如路由器、防火牆、DNS 伺服器、DPI 設備、負載平衡器等），現在以軟體形式運行在虛擬機器 (VM) 或容器 (Container) 中。
    *   **例子：** 一個運行在 VMware ESXi 或 KVM 上的虛擬防火牆，或一個運行在 Docker 容器中的負載平衡器。
    *   **關聯：** VNF 是 NFV 的核心組成部分，實現了網路功能的軟體化和彈性部署。

*   **NFV 基礎設施 (NFV Infrastructure, NFVI)：**
    *   **定義：** 提供虛擬網路功能運行所需的所有硬體和軟體資源，包括通用伺服器、儲存、網路設備，以及虛擬化管理程式 (Hypervisor) 或容器平台。
    *   **例子：** 一個由多台 x86 伺服器組成的集群，上面安裝有 KVM 或 ESXi，提供計算和儲存資源。
    *   **關聯：** NFVI 是 VNF 運行的基礎平台，提供了彈性且可擴展的資源。

*   **NFV 管理與協同 (NFV Management and Orchestration, MANO)：**
    *   **定義：** 負責管理和協調 NFV 環境中的所有組件，包括 VNF 的生命週期管理（部署、擴展、升級、終止）、NFVI 資源的分配與優化，以及服務鏈的編排。
    *   **架構組成：** VNF 管理器 (VNFM)、NFV 協同器 (NFVO)、虛擬基礎設施管理器 (VIM)。
    *   **例子：** 當需要擴展一個 VNF 時，MANO 會在 NFVI 上自動部署一個新的 VNF 實例，並將其集成到服務中。
    *   **關聯：** MANO 是 NFV 的智慧管理層，確保 VNF 和 NFVI 能夠高效、自動地協同工作。

#### 5.2.3 網路切片 (Network Slicing)

**定義：** 網路切片是一種將物理網路基礎設施劃分為多個邏輯上獨立的端到端虛擬網路的方法。每個切片都為特定服務、應用程式或客戶提供定制化的網路能力和資源保證。

**應用場景：** 5G 行動通訊是網路切片最典型的應用場景，它允許營運商為不同的服務需求（如高速寬頻 eMBB、超可靠低延遲通訊 uRLLC、大規模機器通訊 mMTC）提供專屬的網路切片。

*   **eMBB (enhanced Mobile Broadband)：** 高頻寬、低時延，適用於 VR/AR、4K 影音串流。
*   **uRLLC (ultra-Reliable Low Latency Communications)：** 超高可靠性、超低時延，適用於自動駕駛、工業自動化。
*   **mMTC (massive Machine Type Communications)：** 支援海量設備連接、低功耗，適用於物聯網感測器。

**如何實現：** 網路切片依賴於 SDN 和 NFV 技術：
1.  **SDN：** 提供對整個網路的集中式控制，動態分配路徑和配置資源，確保不同切片之間的流量隔離。
2.  **NFV：** 將網路功能虛擬化為 VNF，可以靈活地部署在切片中的任何位置，並根據切片需求進行彈性擴展。
3.  **編排器：** 負責創建、管理和監控網路切片的整個生命週期，包括資源預留、VNF 部署和服務鏈建立。

-----

### 5.3 與相鄰概念的關聯

#### 5.3.1 網路虛擬化與雲端運算

**關聯：** 網路虛擬化是雲端運算基礎設施的基石。
*   **IaaS (Infrastructure as a Service)：** 雲端供應商提供虛擬機器和虛擬網路。虛擬網路允許客戶在雲端建立私有、隔離的網路環境，連接他們的 VMs。SDN 和 NFV 在底層提供這些虛擬網路的彈性部署和管理。
*   **資源彈性：** 雲端環境中需要快速部署、擴展和縮減資源。網路虛擬化使得網路資源也能像計算和儲存資源一樣，隨需應變。
*   **多租戶 (Multi-tenancy)：** 網路虛擬化是實現安全、隔離的多租戶環境的關鍵，不同租戶共用物理資源，但邏輯上彼此隔離。

#### 5.3.2 網路虛擬化與容器技術

**關聯：** 容器技術（如 Docker、Kubernetes）是輕量級的虛擬化形式，網路虛擬化在容器環境中扮演重要角色。
*   **容器網路介面 (CNI)：** Kubernetes 等容器編排系統使用 CNI 插件來為容器提供網路連接和隔離，這些插件常常基於 SDN 思想，例如 Calico、Flannel、Cilium 等，它們會創建虛擬網路介面、虛擬交換器或使用 VXLAN 等隧道技術來實現容器間的通訊和策略執行。
*   **微服務架構：** 容器常用於部署微服務，網路虛擬化提供了微服務之間高效、安全的通訊機制，並能動態調整流量路徑。
*   **NFV 與容器：** 越來越多的 VNF 以容器化的形式部署 (CNF, Containerized Network Functions)，相比 VM 啟動更快、資源消耗更低。

#### 5.3.3 SDN 與 NFV 的互補關係

**定義：** 雖然 SDN 和 NFV 是不同的概念，但它們緊密協作，共同構成了現代虛擬化網路的基礎。
*   **SDN 強化 NFV：** SDN 控制器可以自動化 NFV 服務鏈的建立和管理。當多個 VNF 需要串聯起來提供一個服務（例如：流量通過虛擬防火牆、再通過虛擬 IPS、最後到虛擬負載平衡器），SDN 可以動態編程底層網路，引導流量按照預定順序經過這些 VNF。
*   **NFV 賦能 SDN：** NFV 提供了靈活部署的虛擬網路功能，這些 VNF 可以作為 SDN 應用的一部分被控制器調用和管理。例如，當 SDN 控制器需要一個新的防火牆功能時，NFV 可以快速部署一個虛擬防火牆。

**例子：** 在一個雲端環境中，客戶請求一個帶有特定安全策略的虛擬網路。NFV 負責部署虛擬路由器、虛擬防火牆等 VNF，而 SDN 則負責配置虛擬交換器和路由路徑，確保流量按照防火牆策略正確轉發，並將不同客戶的流量完全隔離。

-----

### 5.4 進階內容

#### 5.4.1 服務鏈 (Service Chaining)

**定義：** 服務鏈是指將多個網路功能（通常是 VNF）按照特定的順序串聯起來，以處理進入網路的流量。這些功能可以包括防火牆、入侵檢測系統 (IDS)、負載平衡器、WAN 優化器等。流量必須依次經過鏈中的每個功能才能到達目的地。

**如何實現：**
1.  **識別流量：** SDN 控制器或編排器識別需要應用服務鏈的流量。
2.  **確定順序：** 定義服務鏈中 VNF 的處理順序。
3.  **流量導引：** SDN 控制器根據順序編程底層網路，將流量從一個 VNF 導向到下一個 VNF，直到鏈末端。這通常涉及動態修改路由表、使用 VXLAN/MPLS 等隧道技術或基於 Segment Routing (如 SRv6) 實現。

**例子：** 一個企業網路可能要求所有外部流量先經過虛擬防火牆、再經過虛擬 IDS、最後由虛擬負載平衡器分發給後端伺服器。服務鏈確保了這一處理順序。

#### 5.4.2 SRv6 (Segment Routing over IPv6)

**定義：** SRv6 是一種基於 IPv6 協定的分段路由 (Segment Routing) 技術。它利用 IPv6 擴展頭 (Extension Headers) 來承載一系列有序的分段指令 (Segment Identifiers, SIDs)，這些指令定義了資料包在網路中的路徑。這使得網路能夠以來源路由 (Source Routing) 的方式精確引導流量，而無需在中間節點維護複雜的狀態。

**關聯：** SRv6 在網路切片和服務鏈中具有巨大潛力。
*   **網路切片：** 透過 SRv6 的靈活路徑編程能力，可以為不同的網路切片創建隔離的、定制化的端到端路徑。
*   **服務鏈：** SIDs 可以代表 VNF 或服務鏈中的特定功能。資料包攜帶的 SID 列表指示其依次訪問哪些 VNF，實現高效、動態的服務鏈編排。

**優勢：**
*   **簡化：** 減少了傳統 MPLS 網路中的信令協定複雜性。
*   **可程式化：** 透過 IPv6 協定頭實現精確的流量工程。
*   **整合：** 將分段路由能力無縫融入到現有的 IPv6 網路中。

-----

### 5.5 常見錯誤與澄清

#### 5.5.1 SDN 與 NFV 是一回事嗎？

**澄清：** 不，SDN 和 NFV 是不同的概念，但它們高度互補且常常協同工作。
*   **SDN 關注點：** **控制與管理**網路設備的行為，將控制平面與資料平面分離，實現網路的可程式化和集中管理。它主要解決「如何智慧地控制網路流量」。
*   **NFV 關注點：** **虛擬化網路功能**本身，將傳統基於硬體的網路功能轉變為軟體運行在通用伺服器上。它主要解決「如何彈性地部署網路功能」。

**類比：**
*   SDN 就像一個樂團的指揮家 (Controller)，負責協調所有樂器 (網路設備) 的演奏，確保音樂 (流量) 按照既定樂譜 (策略) 流動。
*   NFV 就像將樂團中的某些特殊樂器 (專用網路設備) 替換為可以在通用平台上演奏的多功能合成器 (VNF)，這些合成器可以根據需求快速改變音色或數量。
兩者共同努力，讓整個網路運作更高效、靈活。

#### 5.5.2 虛擬網路就不需要實體網路？

**澄清：** 這是個常見的誤解。虛擬網路並不是取代實體網路，而是建立在實體網路之上的**抽象層**。
*   所有虛擬網路（無論是虛擬交換器、虛擬路由器，還是虛擬機器之間的流量），最終都需要底層的物理網路硬體（如物理交換機、路由器、光纖電纜、伺服器網卡）來提供實際的連接、頻寬和處理能力。
*   虛擬化的本質是將物理資源進行**池化和共享**。沒有了物理硬體，虛擬網路將無從談起。
*   網路虛擬化的目標是提高物理網路資源的利用率、靈活性和自動化管理能力，而不是消除物理網路。

-----

### 5.6 小練習 (附詳解)

#### 小練習 5.6.1：設計基於 SDN 的多租戶校園網路

**題目：**
假設你負責為一所大學設計一個新的校園網路。該大學有三類使用者：學生、教職員和訪客。要求為這三類使用者提供網路存取，但需滿足以下條件：
1.  **隔離性：** 三類使用者之間必須實現網路隔離，避免互相影響。
2.  **安全性：** 教職員網路需要比學生和訪客網路更高的安全性策略。
3.  **靈活性：** 能夠快速添加或移除新的安全策略，且不影響網路運行。
4.  **頻寬保證：** 教職員享有優先的頻寬保證。

請說明你如何使用 SDN 技術來滿足這些要求，並列出主要步驟和組件。

**詳解：**

使用 SDN 技術可以有效地解決多租戶隔離、安全策略和頻寬管理的需求。

**主要步驟和組件：**

1.  **SDN 控制器部署：**
    *   **組件：** 部署一個中央 SDN 控制器 (例如 OpenDaylight 或 ONOS)。控制器將是網路的「大腦」，負責所有策略決策和流量編程。
    *   **作用：** 控制器會收集網路拓撲資訊，並根據管理員設定的策略，向底層的 SDN 交換器下發流表規則。

2.  **SDN 交換器部署：**
    *   **組件：** 將校園網中的所有核心和接入交換器替換為支援 OpenFlow 或其他 SDN 南向協定的 SDN 交換器 (物理或虛擬)。
    *   **作用：** 這些交換器只負責純粹的資料轉發，不進行路由決策，一切轉發邏輯由控制器控制。

3.  **虛擬網路 (VLAN/VXLAN) 規劃：**
    *   **策略：** 為每類使用者創建一個邏輯上獨立的虛擬網路。
        *   學生網路：VLAN A (或 VXLAN A)
        *   教職員網路：VLAN B (或 VXLAN B)
        *   訪客網路：VLAN C (或 VXLAN C)
    *   **作用：** 實現三類使用者之間的二層隔離。VMware NSX 等 SDN 解決方案也常用 VXLAN 來提供跨物理邊界的虛擬網路。

4.  **安全策略與頻寬管理：**
    *   **策略：**
        *   **隔離：** 在 SDN 控制器上設定策略，禁止不同 VLAN/VXLAN 之間的直接通訊，除非明確允許。例如，學生網路不能直接存取教職員網路的伺服器。
        *   **教職員安全性：** 為教職員網路定義更嚴格的防火牆規則，例如限制其對某些外部服務的存取，或強制流量經過虛擬防火牆 VNF。這可以在控制器上定義 ACLs，並下發給交換器。
        *   **頻寬保證：** 使用 QoS (Quality of Service) 策略，為教職員網路的流量設定更高的優先級，保證其頻寬。例如，控制器可以為教職員流量的流表規則添加更高的佇列優先級。
    *   **實現：** 透過 SDN 控制器提供的北向 API，管理員或應用程式可以動態地定義和修改這些策略。控制器會將這些策略轉換為底層交換器可執行的流表規則。

5.  **使用者認證與動態分配：**
    *   **策略：** 結合 RADIUS 或其他認證系統，當使用者接入網路時，根據其身份動態分配到對應的虛擬網路 (VLAN/VXLAN)。
    *   **作用：** 例如，當學生使用其學號登入 Wi-Fi 時，控制器會根據認證結果，指示接入交換器將該學生的連接埠或無線會話動態劃分到學生網路 VLAN A。

**優勢：**
*   **集中管理：** 網路管理員透過控制器統一管理所有網路策略，無需單獨配置每台設備。
*   **快速部署與調整：** 新的安全策略或頻寬調整只需在控制器上修改，即可立即生效到整個網路。
*   **自動化：** 透過腳本或應用程式，可以實現網路配置的自動化，減少人為錯誤。
*   **靈活隔離：** 易於創建和管理多個邏輯隔離的網路。

#### 小練習 5.6.2：利用 NFV 部署雲端虛擬防火牆服務

**題目：**
一家雲端服務提供商希望為其租戶提供靈活、按需的虛擬防火牆 (vFW) 服務。傳統的硬體防火牆部署週期長、擴展性差。請說明如何利用 NFV 技術部署這種虛擬防火牆服務，並描述其部署、擴展和管理流程。

**詳解：**

利用 NFV 部署雲端虛擬防火牆服務可以顯著提高部署效率和擴展性。

**主要步驟和流程：**

1.  **NFV 基礎設施 (NFVI) 準備：**
    *   **步驟 1.1：部署通用伺服器集群：** 建立一個由多台標準 x86 伺服器組成的物理集群。這些伺服器將作為計算、儲存和網路資源的載體。
    *   **步驟 1.2：安裝虛擬化管理程式 (Hypervisor)：** 在每台伺服器上安裝 Hypervisor (例如 KVM, VMware ESXi 或 Xen)，用於運行虛擬機器。或者，如果使用容器化 VNF (CNF)，則部署 Kubernetes 等容器平台。
    *   **步驟 1.3：配置網路：** 配置底層物理網路，確保 NFVI 內部和外部的連通性，並準備好用於虛擬網路流量的通道 (例如使用 VLAN, VXLAN)。

2.  **虛擬防火牆 (VNF) 的準備：**
    *   **步驟 2.1：選定或開發 vFW 軟體：** 選擇一個已有的虛擬防火牆軟體（例如 pfSense、FortiGate-VM、Palo Alto Networks VM-Series）或開發自己的防火牆應用。
    *   **步驟 2.2：打包為 VNF 映像：** 將 vFW 軟體打包為虛擬機器映像檔 (例如 OVA, QCOW2) 或容器映像檔 (Docker Image)，並上傳到 VNF 倉庫。

3.  **NFV 管理與協同 (MANO) 平台部署：**
    *   **步驟 3.1：部署 NFV MANO 組件：** 部署 VNF 管理器 (VNFM)、NFV 協同器 (NFVO) 和虛擬基礎設施管理器 (VIM)。
        *   **VIM：** 與 Hypervisor 或容器平台通訊，管理 NFVI 上的計算、儲存和網路資源。
        *   **VNFM：** 負責 vFW VNF 的生命週期管理（啟動、停止、監控、配置等）。
        *   **NFVO：** 負責整個服務的端到端編排，包括 VNF 的部署順序、網路連接和服務鏈的建立。

4.  **虛擬防火牆服務的部署流程：**
    *   **步驟 4.1：租戶請求：** 租戶透過雲端供應商的入口網站或 API 請求一個虛擬防火牆服務。
    *   **步驟 4.2：服務定義：** NFVO 接收請求，並根據預定義的服務模板（包含 vFW VNF 的類型、數量、網路連接要求等）開始執行。
    *   **步驟 4.3：資源分配：** NFVO 指示 VIM 在 NFVI 上分配所需的計算、儲存和網路資源（例如，啟動一個 VM 並為其分配 vCPU、記憶體和虛擬網卡）。
    *   **步驟 4.4：VNF 實例化：** VNFM 從 VNF 倉庫中取出 vFW 映像，在分配的資源上啟動一個或多個 vFW VNF 實例。
    *   **步驟 4.5：網路連接：** NFVO 或 VIM 配置虛擬網路，將 vFW VNF 連接到租戶的虛擬網路中，並設定流量導向規則（例如，所有進出租戶 VPC 的流量都必須經過這個 vFW）。這一步常常與 SDN 協同，由 SDN 控制器來編程底層網路。
    *   **步驟 4.6：配置 VNF：** VNFM 將初始的安全策略和配置推送到新啟動的 vFW VNF。

5.  **虛擬防火牆服務的擴展流程：**
    *   **步驟 5.1：監控與觸發：** MANO 平台持續監控 vFW VNF 的效能指標（如 CPU 利用率、吞吐量），當負載達到預設閾值時，觸發自動擴展。
    *   **步驟 5.2：自動擴展：** NFVO 指示 VNFM 和 VIM 部署更多 vFW VNF 實例，並將它們加入到現有的服務鏈中。
    *   **步驟 5.3：流量重新分配：** SDN 控制器或負載平衡器會自動將新增的 vFW 實例納入服務，實現流量的負載平衡。

6.  **虛擬防火牆服務的管理與維護：**
    *   **步驟 6.1：策略管理：** 租戶可以透過雲端管理介面修改 vFW 的安全策略，這些修改會由 MANO 平台推送給所有相關的 vFW VNF 實例。
    *   **步驟 6.2：監控與故障排除：** MANO 平台提供統一的監控儀表板，即時顯示 vFW 服務的運行狀態和效能。
    *   **步驟 6.3：生命週期管理：** MANO 負責 vFW VNF 的升級、回滾和終止。

**總結：**
透過 NFV，雲端服務提供商能夠以自動化、彈性的方式提供虛擬防火牆服務。租戶可以根據需求快速部署和擴展防火牆資源，無需等待漫長的硬體採購和部署週期，實現真正的按需服務和成本優化。

-----

### 5.7 延伸閱讀/參考

*   **SDN 基礎：**
    *   Goransson, P., & Black, C. (2016). *Software Defined Networks: A Comprehensive Approach*. Morgan Kaufmann.
    *   Open Networking Foundation (ONF) - OpenFlow Specification: [https://www.opennetworking.org/sdn-resources/onf-specifications/openflow/](https://www.opennetworking.org/sdn-resources/onf-specifications/openflow/)
*   **NFV 基礎：**
    *   European Telecommunications Standards Institute (ETSI) NFV White Papers: [https://www.etsi.org/technologies/nfv](https://www.etsi.org/technologies/nfv)
    *   Mijumbi, R., Gorricho, J. L., & Boutaba, R. (2016). *Network Functions Virtualization: State-of-the-Art and Research Challenges*. IEEE Communications Magazine, 54(2), 20-26.
*   **網路虛擬化相關技術：**
    *   VXLAN (Virtual eXtensible LAN) RFC 7348
    *   Container Network Interface (CNI) for Kubernetes: [https://github.com/containernetworking/cni](https://github.com/containernetworking/cni)
    *   Segment Routing over IPv6 (SRv6) RFC 8754