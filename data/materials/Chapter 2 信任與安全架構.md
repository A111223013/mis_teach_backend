# Chapter 2 信任與安全架構

在資訊安全領域，信任與安全架構是設計和實施安全系統的基石。本章將深入探討構成這些架構的核心概念、原則以及實踐機制，旨在建立一套堅實的理解框架。

### 核心概念與定義

#### 信任的定義與類型

信任是資訊安全中的一個關鍵概念，它涉及在面對不確定性時，對某個實體（人、系統、元件、流程）的行為或屬性所抱持的信心。這種信心是基於對該實體能力、意圖和可靠性的評估。

*   **核心觀念：** 信任並非絕對，而是一個動態、有條件且可衡量的關係。它建立在證明（證明其身份）、授權（證明其權限）和驗證（證明其行為符合預期）的基礎之上。
*   **類型：**
    *   **顯性信任 (Explicit Trust)：** 經由明確設定或配置而建立的信任，例如在憑證授權機構 (CA) 列表中手動添加一個根憑證。
    *   **隱性信任 (Implicit Trust)：** 基於預設、慣例或歷史行為而自動建立的信任，例如作業系統預設信任某些核心元件。
    *   **傳遞信任 (Transitive Trust)：** 如果 A 信任 B，且 B 信任 C，則 A 可能間接信任 C。然而，在安全架構中，傳遞信任往往是風險的來源，需要仔細管理。
*   **與相鄰概念的關聯：** 信任與「信任度 (Trustworthiness)」不同。信任度是對實體客觀安全屬性的評估（例如，一個加密演算法的數學安全性），而信任則是主觀或系統級的決定，基於對這種信任度的評估。零信任 (Zero Trust) 架構正是對傳統隱性信任模式的反思。

-----

#### 安全目標：CIA 三要素

CIA 三要素（Confidentiality, Integrity, Availability）是資訊安全的核心目標，任何安全措施或架構都旨在不同程度地達成這些目標。

*   **核心觀念：**
    *   **機密性 (Confidentiality)：** 確保資訊只被授權的實體存取。未經授權的實體無法讀取或理解資料。
        *   **例子：** 使用加密技術保護敏感文件，實施嚴格的存取控制列表 (ACL) 限制檔案訪問權限。
    *   **完整性 (Integrity)：** 確保資訊在整個生命週期中保持準確和完整的狀態，未經授權的實體無法竄改資料，且資料在傳輸或儲存過程中未被意外修改。
        *   **例子：** 使用雜湊函數（如 SHA-256）驗證檔案未被竄改，資料庫事務 (transaction) 確保資料的一致性。
    *   ****可用性 (Availability)：** 確保授權的實體在需要時能夠及時存取和使用資訊或系統服務。
        *   **例子：** 部署備援伺服器、負載平衡，實施災難復原計畫，防禦阻斷服務 (DoS) 攻擊。
*   **與相鄰概念的關聯：** 這三要素之間存在平衡關係，過度強調其中之一可能犧牲其他要素。例如，極致的機密性可能導致較差的可用性（如過度加密導致存取緩慢）。CIA 是評估風險和設計安全控制措施的基礎框架。

-----

#### 安全機制：AAA 模型

AAA 模型是實現安全目標的基礎機制，它描述了資訊系統中對使用者和實體進行管理的關鍵功能。

*   **核心觀念：**
    *   **認證 (Authentication)：** 驗證使用者或實體的身份。證明「你是你聲稱的那個人」。
        *   **方法：**
            *   **你所知道的：** 密碼、PIN 碼。
            *   **你所擁有的：** 硬體令牌、智慧卡、手機簡訊驗證碼。
            *   **你所是的：** 指紋、虹膜、臉部辨識。
        *   **例子：** 輸入帳號密碼登入網站，使用指紋解鎖手機。
    *   **授權 (Authorization)：** 根據已驗證的身份，授予其執行特定操作或存取特定資源的權限。判斷「你被允許做什麼」。
        *   **方法：** 存取控制列表 (ACL)、角色型存取控制 (RBAC)、屬性型存取控制 (ABAC)。
        *   **例子：** 登入系統後，普通使用者只能查看自己的檔案，而管理員可以修改所有檔案。
    *   **計帳 (Accounting)：** 追蹤使用者或實體在系統中的活動，記錄其操作、存取資源和使用時間。用於稽核、故障排除和計費。
        *   **例子：** 系統日誌記錄了誰在何時登入了系統、存取了哪些檔案、進行了何種修改。
*   **與相鄰概念的關聯：** AAA 模型是實施存取控制 (Access Control) 的核心。認證是授權的前提，而計帳則為安全事件響應和合規性提供了證據。

-----

#### 核心安全原則

為了構建強健的安全架構，必須遵循一系列設計原則。

*   **核心觀念：**
    *   **最小權限原則 (Principle of Least Privilege, PoLP)：** 授予使用者、程式或進程完成其任務所需的最低限度權限。
        *   **例子：** 網站的資料庫連接帳戶只應擁有對資料庫讀寫資料的權限，而非建立或刪除整個資料庫的權限。一般使用者不應有安裝軟體的權限。
        *   **推導：** 限制攻擊者一旦突破防線後能造成的損害範圍。即使某個元件被攻陷，由於其權限受限，攻擊者也無法進一步大規模破壞。
    *   **縱深防禦 (Defense in Depth)：** 部署多層次、多類型的安全控制措施，即使某一控制措施失效，仍有其他措施可以提供保護。
        *   **例子：** 防火牆（邊界防禦）+ 入侵偵測系統 (IDS)（網路層防禦）+ 端點防毒軟體（主機層防禦）+ 應用程式安全檢查（應用層防禦）+ 資料加密（資料層防禦）。
        *   **推導：** 任何單一的安全機制都不是萬無一失的。透過疊加不同的安全機制，可以顯著提高系統抵禦攻擊的能力。
*   **與相鄰概念的關聯：** 這些原則是所有安全設計模式和實施方法論的基礎，直接影響了系統的健壯性和韌性。它們與風險管理緊密相連，旨在降低風險暴露。

-----

### 典型例子與轉換/推導

#### CIA 三要素在不同場景中的應用

*   **場景一：網路銀行系統**
    *   **機密性：** 使用 SSL/TLS 加密技術保護客戶端與銀行伺服器之間的通訊；客戶的帳戶餘額、交易紀錄等敏感資訊在資料庫中加密儲存。
    *   **完整性：** 銀行交易必須具備原子性（Atomic）、一致性（Consistent）、隔離性（Isolated）、持久性（Durable），確保資金轉移的準確性；透過數位簽章驗證交易請求未被竄改。
    *   **可用性：** 部署負載平衡器和備援伺服器叢集，確保即使部分伺服器故障，服務仍能持續；實施 DDoS 防護，確保系統在高流量攻擊下仍可提供服務。
*   **場景二：醫療資訊系統**
    *   **機密性：** 患者病歷資料受到嚴格存取控制，只有授權醫護人員可查看；資料傳輸使用加密通道，遵循 HIPAA 等法規要求。
    *   **完整性：** 醫生開立的處方、診斷記錄在輸入後不可隨意修改，任何修改都需留下審計紀錄；藥品庫存數據保持準確，避免錯誤給藥。
    *   **可用性：** 醫院的急診系統必須全天候運作，即使停電也能透過備用電源維持；手術室的監測設備數據流必須不間斷。

-----

#### AAA 模型在系統登入流程中的體現

一個典型的使用者登入流程完美詮釋了 AAA 模型：

1.  **使用者嘗試登入：** 輸入使用者名稱和密碼。
2.  **認證 (Authentication)：** 系統接收使用者提交的憑證，將其與儲存的憑證（通常是密碼雜湊）進行比對。
    *   如果匹配，則身份驗證成功，使用者被確認為其所聲稱的身份。
    *   如果不匹配，則身份驗證失敗，使用者無法繼續。
3.  **授權 (Authorization)：** 身份驗證成功後，系統根據該使用者的角色或權限設定，決定其可以存取哪些資源或執行哪些操作。
    *   例如，管理員可以訪問後台管理介面，而普通使用者只能訪問前端應用。
    *   例如，某使用者可以讀取某檔案，但不能修改或刪除。
4.  **計帳 (Accounting)：** 系統記錄此次登入事件（時間、使用者、IP 位址、成功/失敗），以及使用者隨後在系統中的所有操作（例如，存取了哪個檔案、執行了什麼命令、修改了哪些數據）。這些記錄儲存在日誌檔中，以備後續稽核或分析。

-----

#### 信任模型範例：公開金鑰基礎建設 (PKI)

PKI 是一個信任模型，用於管理數位憑證和公開金鑰加密。它透過建立一個分層的信任結構來實現顯性信任。

1.  **信任根 (Trust Anchor)：** 最頂層是根憑證授權機構 (Root CA)。它的公開金鑰是透過帶外（out-of-band）方式或預設配置（如作業系統或瀏覽器內建）被使用者或系統顯式信任的。
2.  **憑證授權機構 (CA)：** 根 CA 簽發下一級 CA 的憑證，這些 CA 又可以簽發實體（使用者、伺服器、組織）的數位憑證。
3.  **信任鏈 (Chain of Trust)：** 當一個實體向另一個實體（例如，瀏覽器訪問網站）呈現其數位憑證時，接收方會驗證從實體憑證到其上級 CA，再到根 CA 的整個簽章鏈。如果鏈上的所有憑證都有效且最終連結到一個受信任的根 CA，那麼該實體的身份就被信任。

*   **推導：** PKI 將信任從少數幾個受信任的根傳遞給大量的終端實體。這種結構將信任管理集中化，並允許在沒有直接關係的實體之間建立信任關係。但傳遞信任的弱點也體現在，一旦鏈中任何一個 CA 被攻陷，所有由其簽發的憑證都可能失效或被濫用。

-----

### 與相鄰概念的關聯

#### CIA 與風險管理的關係

CIA 三要素是風險管理過程中的核心評估標準。

*   **風險評估：** 識別資產的脆弱性 (vulnerability) 和潛在威脅 (threat) 時，會評估這些威脅可能對資產的機密性、完整性或可用性造成的衝擊。例如，資料外洩會衝擊機密性；惡意程式竄改數據會衝擊完整性；阻斷服務攻擊會衝擊可用性。
*   **風險回應：** 選擇和實施安全控制措施（如加密、備份、防火牆）時，其目的就是為了降低特定威脅對 CIA 的影響程度，將風險降至可接受水平。
*   **合規性：** 許多法規和標準（如 GDPR, PCI DSS）都明確要求保護特定資訊的機密性、完整性和可用性。

-----

#### AAA 與存取控制的關係

AAA 模型是實施存取控制的基礎框架。

*   **認證 (Authentication)** 是存取控制的門檻。只有通過身份驗證的實體才能進入系統或請求資源。
*   **授權 (Authorization)** 則是存取控制的核心決策機制。它基於認證後的身份，決定了實體可以對哪些資源執行何種操作。存取控制策略（如 RBAC、ABAC）正是授權機制的具體實現。
*   **計帳 (Accounting)** 提供了存取控制的事後追溯能力，確保所有存取行為都有紀錄可循，是稽核和響應安全事件的關鍵。

-----

#### 信任與零信任架構的關係

傳統安全模型通常基於「網路邊界內即信任」的假設。一旦實體進入了內部網路，就被隱式信任。

*   **零信任 (Zero Trust) 架構：** 反其道而行之，主張「永不信任，始終驗證 (Never Trust, Always Verify)」。
    *   **核心觀念：** 不論使用者、裝置或應用程式位於網路何處（內部或外部），每次存取嘗試都必須經過嚴格的認證和授權。
    *   **關係：** 零信任架構將信任轉化為一種嚴格、動態的驗證過程。它消除了傳統的隱性信任，要求對每個請求進行明確的信任評估。這並不意味著沒有信任，而是將信任轉化為基於連續驗證、最小權限和上下文感知的動態判斷。
    *   **推導：** 零信任模型鼓勵更細粒度的存取控制、持續的監控和多因素認證，以應對日益複雜的網路威脅和內部威脅。

-----

### 常見錯誤與澄清

#### 混淆「信任」與「信任度」

*   **常見錯誤：** 認為只要一個系統是「可信賴的」(trustworthy)，就意味著它在任何情況下都應被「信任」(trusted)。
*   **澄清：** 「信任度」是一個客觀屬性，描述一個實體的可靠性、安全性特徵。例如，一個經過嚴格安全審計、沒有已知漏洞的軟體模組，其信任度較高。
*   「信任」則是一個主觀或系統操作。即使一個模組的信任度很高，基於最小權限原則，我們也只會賦予它完成特定任務所需的最小權限，而非無限制的信任。在安全架構中，不應盲目地信任任何實體，而應基於其上下文和驗證結果來動態建立和管理信任。

-----

#### 誤解 CIA 各要素的獨立性

*   **常見錯誤：** 認為機密性、完整性、可用性是相互獨立的目標，可以各自為政地實施。
*   **澄清：** CIA 三要素是高度相關且相互依存的。對其中一個要素的損害，往往會影響到其他要素。
    *   例如，資料完整性受損（數據被竄改）可能會導致使用者對其機密性產生懷疑（是否真實數據被惡意公開），同時也可能影響依賴這些數據的服務的可用性。
    *   過度追求機密性（如極端複雜的加密和多層認證）可能會降低系統的可用性（存取變得極其緩慢或困難）。
*   因此，設計安全架構時需要全面考量這三者，尋求一個適合業務需求和風險承受能力的平衡點。

-----

#### 混淆認證與授權

*   **常見錯誤：** 認為只要使用者通過了認證（例如登入成功），就意味著他們可以做任何事情。
*   **澄清：** 認證 (Authentication) 只是證明「你是誰」。而授權 (Authorization) 才是決定「你能做什麼」。
*   一個典型的例子是，你可能成功登入了公司的內部系統（認證成功），但作為普通員工，你無法存取人力資源部門的薪資數據（未被授權）。這是安全架構中最小權限原則的直接體現。嚴格區分這兩者是實施精細化存取控制的關鍵。

-----

### 小練習（附詳解）

#### 小練習一：設計基於 CIA/AAA 的安全方案

**題目：**
你被要求為一家新成立的線上圖書館設計基礎安全架構。該圖書館提供電子書借閱服務，並允許使用者上傳自己創作的書籍。請你從 CIA 三要素和 AAA 模型的角度，列出至少各兩項你認為最關鍵的安全措施。

**步驟：**

1.  **分析圖書館業務場景：** 識別涉及的資產（使用者資料、電子書內容、支付資訊等）和潛在風險。
2.  **應用 CIA 三要素：** 針對機密性、完整性和可用性，各提出至少兩項具體安全措施。
3.  **應用 AAA 模型：** 針對認證、授權和計帳，各提出至少兩項具體機制。
4.  **綜合考量：** 確保提出的措施符合最小權限和縱深防禦的原則。

**詳解：**

1.  **業務場景分析：**
    *   **使用者資料：** 帳號、密碼、借閱歷史、上傳書籍記錄。
    *   **電子書內容：** 商業電子書（需版權保護）、使用者上傳書籍。
    *   **交易資訊：** 訂閱費用、購買記錄。
    *   **潛在風險：** 敏感資料洩露、電子書被非法複製或篡改、系統被攻擊導致服務中斷、使用者濫用權限上傳違禁內容。

2.  **基於 CIA 三要素的安全措施：**
    *   **機密性 (Confidentiality)：**
        *   所有使用者數據（包括密碼雜湊、借閱歷史、上傳內容元數據）在資料庫中加密儲存。
        *   使用者與伺服器之間的所有通訊強制使用 SSL/TLS 加密協定 (HTTPS)。
    *   **完整性 (Integrity)：**
        *   電子書上傳後進行內容雜湊檢查，確保在儲存和傳輸過程中未被竄改。對重要內容可採用數位簽章。
        *   資料庫事務處理確保借閱、歸還等操作的原子性和一致性，防止資料錯亂。
    *   **可用性 (Availability)：**
        *   部署負載平衡器和多個應用伺服器，實現服務冗餘，提高系統容錯能力。
        *   定期備份所有資料（包括使用者資料和電子書庫），並制定災難復原計畫，確保在重大故障後能快速恢復服務。

3.  **基於 AAA 模型的安全機制：**
    *   **認證 (Authentication)：**
        *   使用者註冊和登入時，要求使用強密碼政策（複雜度、長度、定期更換），並可選啟用多因素認證 (MFA)。
        *   支援第三方登入 (如 Google/Facebook OAuth)，但需確保其安全性及使用者隱私保護。
    *   **授權 (Authorization)：**
        *   實施角色型存取控制 (RBAC)：區分普通使用者（借閱、上傳自己的書）、付費會員（借閱更多書）、管理員（管理所有書籍、使用者）等角色，並為每個角色分配最小必要的權限。
        *   使用者上傳的書籍預設為草稿狀態，需經過管理員審核才能發布（內容審核權限）。
    *   **計帳 (Accounting)：**
        *   詳細記錄所有使用者操作日誌，包括登入/登出、借閱/歸還、上傳/刪除書籍等行為，以備稽核和追溯。
        *   系統管理員的敏感操作（如修改權限、刪除內容）需有獨立的審計日誌，並實施雙人審核機制。

-----

#### 小練習二：識別信任邊界與安全原則

**題目：**
一家軟體公司開發了一個基於微服務架構的雲端應用程式。該應用由三個核心微服務組成：`使用者管理服務 (UMS)`、`訂單處理服務 (OPS)` 和 `支付服務 (PPS)`。所有服務都部署在同一個雲廠商的私有網路內，並透過內部 API 互相通訊。外部使用者透過 API Gateway 存取應用。

請你：

1.  識別這個架構中的主要信任邊界。
2.  解釋為何 `UMS` 在呼叫 `PPS` 時，應遵循最小權限原則。

**步驟：**

1.  **定義信任邊界：** 找出不同實體之間，信任關係發生變化的點。
2.  **分析信任關係：** 考量外部使用者、API Gateway、微服務之間的互動。
3.  **解釋最小權限：** 說明為何 `UMS` 對 `PPS` 的呼叫需要嚴格的權限控制。

**詳解：**

1.  **主要信任邊界：**
    *   **邊界一：外部使用者 與 API Gateway 之間。** 這是最外部的信任邊界。外部使用者是未經驗證的，API Gateway 作為入口，需要對外部請求進行初步的身份驗證、流量過濾和安全檢查，以保護內部微服務。
    *   **邊界二：API Gateway 與 內部微服務 (UMS/OPS/PPS) 之間。** 儘管 API Gateway 位於內部網路邊緣，但它作為外部請求的代理，仍需嚴格控制其對內部微服務的存取權限。不應將通過 API Gateway 的請求完全等同於內部信任。
    *   **邊界三：各微服務之間 (UMS, OPS, PPS)。** 即使這些微服務部署在同一個私有網路內，並由同一家公司開發，它們之間仍然存在信任邊界。每個微服務都應該被視為潛在的獨立安全域。一個服務不應該無條件信任另一個服務的輸入或授權其執行所有操作。這正是零信任原則在內部網路中的體現。
    *   **邊界四：微服務 與 資料庫/其他後端資源 之間。** 每個微服務在存取其後端的資料庫或其他儲存/服務時，也應被視為一個信任邊界。

2.  **為何 `UMS` 在呼叫 `PPS` 時應遵循最小權限原則？**
    *   **職責分離：** `UMS`（使用者管理服務）的主要職責是管理使用者資訊，而 `PPS`（支付服務）的主要職責是處理支付交易。兩者有明確的職責分工。
    *   **限制攻擊面：** 如果 `UMS` 被攻陷（例如，存在漏洞導致被注入惡意程式碼），攻擊者將獲得 `UMS` 所擁有的所有權限。
    *   **最小權限原則的應用：**
        *   `UMS` 服務可能需要呼叫 `PPS` 來核實使用者支付能力的狀態，或者觸發支付流程中的特定環節（例如，為使用者退款或確認訂單支付）。
        *   然而，`UMS` **不應該** 擁有 `PPS` 的全部管理權限，例如不應該能夠修改 `PPS` 的配置、創建新的支付閘道或直接操作所有支付記錄。
        *   `UMS` 應該只被授權執行 `PPS` 中與使用者管理相關、且完成其自身核心業務邏輯所必需的最小集合的操作（例如，查詢特定使用者的支付狀態，或發起一個預定義的退款流程）。
    *   **降低風險：** 透過限制 `UMS` 對 `PPS` 的權限，即使 `UMS` 遭受攻擊，攻擊者也無法利用 `UMS` 的權限在 `PPS` 中進行大規模的破壞或非法操作，從而限制了攻擊的「橫向移動」能力和潛在的損失範圍。這體現了縱深防禦和最小權限協同作用。

-----

### 延伸閱讀/參考

*   **經典書籍：**
    *   "Security Engineering" by Ross Anderson: 資訊安全領域的經典著作，涵蓋了廣泛的安全概念和設計原則。
    *   "The Phoenix Project" by Gene Kim, Kevin Behr, and George Spafford: 雖然是關於 DevOps，但其對系統可靠性和可用性的討論與本章內容有重要關聯。
*   **安全標準與框架：**
    *   **NIST SP 800-53 (Security and Privacy Controls for Federal Information Systems and Organizations):** 提供了全面的安全控制措施清單，其設計原則與 CIA/AAA 高度相關。
    *   **ISO/IEC 27000 系列標準 (Information Security Management Systems):** 國際公認的資訊安全管理體系標準，其中許多條款都圍繞著保護資訊的 CIA。
*   **零信任架構：**
    *   **NIST SP 800-207 (Zero Trust Architecture):** 詳細解釋了零信任的原則、邏輯組件和部署模型。
    *   **"Zero Trust Networks: Building Secure Systems in a Hostile Environment" by John Kindervag and Evan Gilman:** 詳細介紹了零信任概念的起源與實踐。