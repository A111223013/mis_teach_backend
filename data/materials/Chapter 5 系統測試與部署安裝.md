# Chapter 5 系統測試與部署安裝

本章將深入探討軟體開發生命週期中兩個至關重要的階段：系統測試與部署安裝。透過系統測試，我們確保開發完成的軟體符合所有既定需求與品質標準；而部署安裝則是將系統安全、高效地交付給使用者，使其在生產環境中穩定運作的關鍵環節。我們將剖析其核心概念、典型實踐、常見挑戰及最佳解決方案。

-----

### 5.1 核心概念/定義

#### 5.1.1 系統測試 (System Testing)

**定義**: 系統測試是一種軟體測試，用於評估一個完整的、整合的軟體系統，以驗證其是否符合所指定的系統需求。它通常是一個黑箱測試（Black-box Testing）的過程，著重於系統的外部行為而非內部結構。

**核心觀念**:
*   **端到端 (End-to-End)**: 測試整個系統的完整工作流程，包括所有元件、介面、資料庫和外部系統的交互。
*   **符合需求 (Requirement Conformance)**: 主要目標是驗證系統是否滿足所有功能性與非功能性需求，而非僅僅發現程式錯誤。
*   **使用者視角 (User Perspective)**: 模擬最終使用者實際使用系統的情境，確保系統行為符合其預期。

**與相鄰概念的關聯**:
*   **與單元測試 (Unit Testing) 的區別**: 單元測試關注最小程式碼單元的正確性；系統測試則關注整個系統作為一個整體的功能。
*   **與整合測試 (Integration Testing) 的區別**: 整合測試驗證模組之間的介面與數據流；系統測試則更上一層樓，驗證各模組整合後的系統級行為。
*   **與驗收測試 (Acceptance Testing, UAT) 的關聯**: 系統測試為驗收測試提供了相對穩定的系統版本，UAT 通常由客戶或最終使用者進行，以確認系統滿足業務需求。

-----

#### 5.1.2 系統測試的類型

系統測試包含多種子類型，旨在從不同維度全面評估系統品質。

##### 5.1.2.1 功能測試 (Functional Testing)
**定義**: 驗證系統是否依照功能規格書（Functional Specifications）或使用者故事（User Stories）正確地執行其所應提供的功能。

**核心觀念**: 關注「系統做了什麼？」
**例子**:
*   使用者能成功登入並瀏覽商品。
*   商品能正確加入購物車並顯示總價。
*   訂單建立後，系統能產生訂單號並更新庫存。

##### 5.1.2.2 非功能測試 (Non-Functional Testing)
**定義**: 評估系統的非功能性特徵，這些特徵定義了系統「如何」表現，而非「做了什麼」。

*   **效能測試 (Performance Testing)**
    *   **定義**: 評估系統在特定負載條件下的響應速度、穩定性、可擴展性和資源利用率。
    *   **類型**:
        *   **負載測試 (Load Testing)**: 測量系統在預期使用者負載下的行為。
        *   **壓力測試 (Stress Testing)**: 測試系統在超出正常負載極限時的穩定性和恢復能力。
        *   **容量測試 (Capacity Testing)**: 確定系統可以處理的最大使用者數量或資料量。
    *   **例子**:
        *   網站能在 1000 個併發使用者下，頁面加載時間小於 2 秒。
        *   API 回應時間應在 200 毫秒內。

*   **安全測試 (Security Testing)**
    *   **定義**: 驗證系統是否能抵抗惡意攻擊，保護資料的機密性、完整性與可用性。
    *   **例子**:
        *   防止 SQL 注入、跨站腳本 (XSS) 攻擊。
        *   使用者權限管理是否正確，未經授權無法存取敏感資料。
        *   資料傳輸是否加密。

*   **可用性測試 (Usability Testing)**
    *   **定義**: 評估系統對使用者而言是否容易學習、操作、理解，以及是否令人滿意。
    *   **例子**:
        *   使用者介面 (UI) 是否直觀、易於導航。
        *   錯誤訊息是否清晰、有幫助。
        *   常見操作流程是否順暢。

*   **可靠性測試 (Reliability Testing)**
    *   **定義**: 評估系統在長時間運行下保持其功能正常運行的能力。
    *   **例子**:
        *   系統在連續運行 72 小時後，平均故障間隔時間 (MTBF) 達到標準。
        *   發生故障時，系統能否自動恢復。

*   **相容性測試 (Compatibility Testing)**
    *   **定義**: 驗證系統在不同硬體、軟體、作業系統、網路環境或瀏覽器下的運作情況。
    *   **例子**:
        *   網站能在 Chrome, Firefox, Safari 等主流瀏覽器中正常顯示和操作。
        *   App 能在 iOS 15 和 Android 12 上運行無誤。

*   **回歸測試 (Regression Testing)**
    *   **定義**: 驗證對系統的修改（如新增功能、修復 Bug 或性能優化）沒有引入新的錯誤或導致現有功能失效。
    *   **例子**:
        *   發布新版本前，執行所有核心功能的測試案例，確保舊功能依然正常。

-----

#### 5.2 部署安裝 (Deployment Installation)

**定義**: 部署安裝是將開發完成並測試驗證的軟體應用程式或系統，配置、安裝到目標執行環境（通常是生產環境）的過程，使其能夠被最終使用者存取和使用。

**核心觀念**:
*   **環境一致性**: 確保開發、測試與生產環境盡可能保持一致，以減少「在我的機器上可以運行」的問題。
*   **自動化**: 透過自動化工具和流程來減少人工錯誤、提高效率並確保可重複性。
*   **高可用性**: 盡量減少部署過程中的服務中斷時間。
*   **可回滾性**: 部署失敗時能夠快速且安全地恢復到舊版本。

**與相鄰概念的關聯**:
*   **與開發的關聯**: 部署是開發團隊成果的最終交付。
*   **與測試的關聯**: 部署前的系統測試確保交付的品質；部署後的測試（例如煙霧測試、健康檢查）驗證部署是否成功。
*   **與營運 (Operations) 的關聯**: 部署是 DevOps 流程的核心環節，緊密結合後續的監控、維護與營運。

-----

#### 5.2.1 部署策略 (Deployment Strategies)

為了最小化部署風險和服務中斷，業界發展出多種部署策略。

*   **藍綠部署 (Blue-Green Deployment)**
    *   **定義**: 維護兩套幾乎相同的生產環境，一套是當前活躍的「藍色」環境，另一套是預備用於部署新版本的「綠色」環境。新版本部署到綠色環境中，經過測試確認無誤後，將流量從藍色環境一次性切換到綠色環境。舊的藍色環境則保留作為備份或回滾目標。
    *   **優點**: 零停機時間、快速回滾。
    *   **缺點**: 需要兩套完整的生產環境資源，成本較高。

*   **金絲雀部署 (Canary Deployment)**
    *   **定義**: 將新版本應用程式先部署到一小部分伺服器實例或使用者群體（「金絲雀」組），觀察其行為、效能和錯誤率。如果金絲雀版本表現穩定，則逐步擴大部署範圍，直到所有實例都更新為新版本。
    *   **優點**: 風險最小化、及早發現問題、逐步推出。
    *   **缺點**: 部署過程較慢，需要良好的監控系統來評估金絲雀版本。

*   **滾動部署 (Rolling Deployment)**
    *   **定義**: 逐步替換現有的應用程式實例。每次替換一小部分（例如，每次更新集群中的一個節點），直到所有實例都更新為新版本。在替換過程中，服務會持續運行。
    *   **優點**: 逐步更新、無需額外硬體、有一定回滾能力。
    *   **缺點**: 如果新版本有 Bug，影響會逐步擴大；回滾速度不如藍綠部署快。

*   **A/B 測試部署 (A/B Testing Deployment)**
    *   **定義**: 部署多個不同版本的應用程式或功能（例如 A 版和 B 版）到不同的使用者群體，收集數據比較哪個版本表現更好（例如轉換率、使用者參與度）。主要用於產品功能實驗和決策，而非純粹的部署風險控制。
    *   **結合部署策略**: 可以將新功能作為 B 版本，透過金絲雀或藍綠部署來進行實驗。

-----

#### 5.2.2 部署流程與工具

部署通常涉及一系列步驟，現代實踐強調自動化這些步驟。

*   **環境準備**: 確保目標伺服器、網路、資料庫、作業系統及相關依賴（如 Java Runtime, Node.js 環境）已正確配置。
*   **程式碼建置與打包**:
    *   從版本控制系統（如 Git）獲取最新的程式碼。
    *   編譯原始碼，生成可執行文件或位元組碼。
    *   打包應用程式及其所有依賴項成一個部署單元，例如 JAR 文件、WAR 文件、Docker 映像檔或 Nginx 配置檔。
*   **配置管理**:
    *   根據目標環境（開發、測試、生產）注入正確的配置參數，如資料庫連線字串、API 金鑰、環境變數。
    *   通常使用配置管理工具 (如 Ansible, Puppet, Chef) 或 CI/CD 管線中的變數替換功能。
*   **自動化部署**: 使用工具自動化上述步驟，以減少人工錯誤並提高效率。
    *   **CI/CD (Continuous Integration/Continuous Deployment)**:
        *   **持續整合 (CI)**: 開發者頻繁地將程式碼整合到共享儲存庫，每次整合都會觸發自動化建置和測試。
        *   **持續部署 (CD)**: 自動化將程式碼部署到各種環境，最終到達生產環境。
        *   **常見工具**: Jenkins, GitLab CI/CD, GitHub Actions, Azure DevOps, CircleCI。
    *   **容器化 (Containerization)**:
        *   **定義**: 將應用程式及其所有運行時依賴（程式碼、運行時、系統工具、函式庫）打包成一個輕量級、可攜帶的獨立單元，稱為容器。
        *   **優點**: 環境一致性、隔離性、快速啟動。
        *   **工具**: Docker (用於創建容器), Kubernetes (K8s, 用於容器編排和管理)。

-----

### 5.3 典型例子與轉換/推導

#### 5.3.1 系統測試案例的設計 (Designing System Test Cases)

設計系統測試案例的過程通常從需求文件出發，將抽象的需求轉換為具體、可執行的測試步驟。

**範例**: 設計一個線上購物網站的「使用者註冊」功能測試案例。

**需求**:
1.  使用者應能透過電子郵件和密碼註冊帳戶。
2.  密碼必須符合特定複雜度要求（例如，至少 8 個字元，包含大小寫字母和數字）。
3.  電子郵件地址必須是有效格式且未被註冊。
4.  註冊成功後，使用者應自動登入。

**測試案例 (Test Cases) 設計**:

| 測試案例 ID | 描述                       | 前置條件                       | 測試步驟                                                                                                     | 預期結果                                                                           |
| :---------- | :------------------------- | :----------------------------- | :----------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------- |
| TC-Reg-001  | 成功註冊新帳戶             | 測試環境就緒，無使用者登入。   | 1. 導航至註冊頁面。<br/>2. 輸入未被註冊的有效電子郵件地址 (例如: `test001@example.com`)。<br/>3. 輸入符合複雜度要求的密碼 (例如: `Password123`)。<br/>4. 確認密碼。<br/>5. 點擊「註冊」按鈕。 | 系統顯示「註冊成功」訊息。<br/>使用者自動登入，並跳轉至主頁或個人中心。<br/>資料庫中新增使用者紀錄。 |
| TC-Reg-002  | 使用已註冊的電子郵件註冊   | 帳戶 `test001@example.com` 已存在。 | 1. 導航至註冊頁面。<br/>2. 輸入已註冊的電子郵件地址 (`test001@example.com`)。<br/>3. 輸入符合要求的密碼。<br/>4. 點擊「註冊」按鈕。 | 系統顯示錯誤訊息「該電子郵件地址已被註冊」。<br/>使用者停留在註冊頁面。           |
| TC-Reg-003  | 密碼不符合複雜度要求       | 無使用者登入。                 | 1. 導航至註冊頁面。<br/>2. 輸入未被註冊的有效電子郵件地址。<br/>3. 輸入不符合複雜度要求的密碼 (例如: `short`)。<br/>4. 點擊「註冊」按鈕。 | 系統顯示錯誤訊息，指出密碼不符合要求 (例如:「密碼長度至少為 8 個字元，並包含大小寫字母和數字」)。<br/>使用者停留在註冊頁面。 |
| TC-Reg-004  | 電子郵件格式無效           | 無使用者登入。                 | 1. 導航至註冊頁面。<br/>2. 輸入無效的電子郵件格式 (例如: `invalid-email`)。<br/>3. 輸入符合要求的密碼。<br/>4. 點擊「註冊」按鈕。 | 系統顯示錯誤訊息「請輸入有效的電子郵件地址」。<br/>使用者停留在註冊頁面。           |

-----

#### 5.3.2 自動化部署流程的推導 (Derivation of Automated Deployment Process)

從手動部署的痛點出發，我們可以推導出自動化部署流程的必要性與演進。

**手動部署的痛點**:
*   **耗時**: 每個步驟都需要人工執行，耗費大量時間。
*   **易出錯**: 人工操作容易遺漏步驟、輸入錯誤，導致部署失敗。
*   **缺乏一致性**: 每次部署的環境或配置可能因操作者不同而異。
*   **難以追溯**: 部署記錄不完整，難以追查問題根源。

**自動化部署的演進路徑**:

1.  **腳本化 (Scripting)**:
    *   **概念**: 將一系列重複的手動部署步驟編寫成腳本（如 Bash Shell Script, Python Script）。
    *   **例子**: 一個 `deploy.sh` 腳本可能包含：
        ```bash
        #!/bin/bash
        echo "Updating code..."
        git pull origin main
        echo "Building application..."
        npm install
        npm run build
        echo "Restarting service..."
        sudo systemctl restart mywebapp
        echo "Deployment complete."
        ```
    *   **效益**: 減少人工干預，提高速度和一致性。
    *   **限制**: 腳本維護成本高、錯誤處理較原始、難以跨多台機器協調。

2.  **配置管理工具 (Configuration Management Tools)**:
    *   **概念**: 使用專門工具來自動化伺服器配置、軟體安裝和應用程式部署，通常採用聲明式配置。
    *   **工具**: Ansible, Chef, Puppet, SaltStack。
    *   **效益**: 更高的自動化層次、易於管理多台伺服器、保證環境一致性、版本控制配置。
    *   **限制**: 需要學習特定工具的語法和概念。

3.  **CI/CD 管線 (CI/CD Pipeline)**:
    *   **概念**: 將建置、測試、打包和部署的整個軟體交付流程串聯成一個自動化管線。當程式碼提交到版本控制系統時，自動觸發管線執行。
    *   **階段**:
        *   **建置 (Build)**: 獲取程式碼、編譯、單元測試。
        *   **測試 (Test)**: 執行整合測試、系統測試、效能測試、安全掃描。
        *   **打包 (Package)**: 將應用程式打包成可部署的成品 (如 Docker 映像檔、二進位包)。
        *   **部署 (Deploy)**: 將成品部署到不同環境（開發、測試、預生產、生產），並實施選擇的部署策略。
        *   **監控與驗證 (Monitor & Verify)**: 部署後持續監控系統健康狀況，確保服務正常。
    *   **效益**: 實現高度自動化、加速交付、提高軟體品質、降低風險、促進團隊協作。
    *   **推導**: 腳本化和配置管理工具解決了單點自動化問題，而 CI/CD 管線則將整個軟體交付流程端到端地自動化，是實現 DevOps 的核心實踐。

-----

### 5.4 與相鄰概念的關聯

#### 5.4.1 系統測試與軟體開發生命週期 (SDLC)

系統測試是軟體開發生命週期中的一個關鍵階段，它與其他階段緊密相連：

*   **需求分析**: 系統測試的測試案例直接源於需求規格。需求不明確或錯誤會直接導致系統測試的困難和缺陷遺漏。
*   **設計**: 系統設計決定了系統的架構和模組間的交互，影響測試的複雜性和範圍。
*   **實作**: 實作的品質（單元測試覆蓋率、程式碼品質）會影響系統測試發現 Bug 的數量和難度。
*   **維護**: 系統測試的完整性有助於維護階段快速定位和修復 Bug，同時回歸測試確保維護不會引入新問題。

#### 5.4.2 部署與 DevOps 理念

部署是 DevOps（開發與營運）理念的核心實踐之一。DevOps 強調開發團隊與營運團隊之間的協作、自動化和持續改進。

*   **持續整合 (CI) 與持續交付/部署 (CD)**: 這是 DevOps 的基石。CI 確保程式碼頻繁整合並通過基本測試，CD 則將自動化延伸到部署環節，實現快速、可靠的軟體發布。
*   **自動化**: DevOps 鼓勵將部署、配置、監控等所有重複性任務自動化，減少人工錯誤，提高效率。
*   **監控與反饋**: 部署後，系統的運行狀態必須被持續監控，並將效能、錯誤等資訊反饋給開發團隊，形成閉環，以便快速迭代和改進。
*   **基礎設施即程式碼 (Infrastructure as Code, IaC)**: 將基礎設施的配置和管理編寫成程式碼，可以像應用程式程式碼一樣進行版本控制、測試和自動部署，確保環境的一致性。

-----

### 5.5 進階內容

#### 5.5.1 混沌工程 (Chaos Engineering)

**定義**: 混沌工程是一種在生產環境中主動、有計畫地注入故障，以發現系統弱點和評估系統彈性的實踐。目標是讓系統在面對真實世界的意外故障時更具韌性。

**核心觀念**:
*   **主動式測試**: 不等問題發生，而是主動製造問題。
*   **生產環境**: 在真實的、複雜的生產環境中進行，因為測試環境難以完全模擬真實世界的挑戰。
*   **發現未知弱點**: 旨在發現傳統測試難以捕捉的系統級別的脆弱性。

**與系統測試的關聯**:
混沌工程可以被視為一種更進階、更具破壞性的非功能性測試。它超越了預設的測試案例，通過模擬極端或異常情況來挑戰系統的極限和恢復能力，特別適用於分散式、微服務架構的系統。

**例子**:
*   隨機關閉生產環境中的部分伺服器實例。
*   模擬網路延遲或斷線。
*   使資料庫暫時不可用。
*   注入資源耗盡 (CPU、記憶體) 的故障。
*   Netflix 的 Chaos Monkey 是最著名的混沌工程工具之一。

-----

#### 5.5.2 無服務器部署 (Serverless Deployment)

**定義**: 無服務器（Serverless）部署是一種雲端計算模型，允許開發者建構和運行應用程式，而無需管理任何伺服器。雲服務供應商負責底層基礎設施的管理、資源配置和擴展。開發者只需上傳程式碼，應用程式會根據事件觸發執行並按需付費。

**核心觀念**:
*   **事件驅動**: 應用程式程式碼（功能，Function）由特定事件（如 HTTP 請求、資料庫變動、檔案上傳）觸發執行。
*   **自動擴展**: 系統根據負載自動擴展或縮減資源。
*   **按用量付費**: 只為實際執行的計算時間和資源付費，沒有閒置成本。
*   **無需伺服器管理**: 開發者無需關心伺服器的配置、維護、更新和容量規劃。

**與傳統部署的差異**:
傳統部署需要維護伺服器或容器集群，並進行資源管理。無服務器部署將這些營運負擔轉嫁給雲服務商，使開發者能更專注於業務邏輯。部署單元通常更小（單一功能），而不是整個應用程式。

**工具**:
*   **AWS Lambda**: 亞馬遜雲服務的無服務器計算服務。
*   **Google Cloud Functions**: Google 雲服務的無服務器功能平台。
*   **Azure Functions**: 微軟 Azure 雲服務的無服務器計算服務。

-----

### 5.6 常見錯誤與澄清

#### 5.6.1 系統測試的常見錯誤

1.  **混淆測試層級**:
    *   **錯誤**: 將單元測試或整合測試的工作（例如，測試單個函式或 API 介面）推給系統測試，導致系統測試範圍不明確、測試重複。
    *   **澄清**: 系統測試應專注於整個系統的端到端行為和使用者流程，假設底層單元和介面已經通過相應層級的測試。

2.  **缺乏有效的測試案例設計**:
    *   **錯誤**: 測試案例過於簡略、缺乏清晰的步驟和預期結果；或者覆蓋率不足，未能涵蓋所有重要功能和邊界條件。
    *   **澄清**: 測試案例必須從需求出發，詳細定義前置條件、執行步驟、輸入數據和預期輸出。應採用不同的測試設計技術（如邊界值分析、等價劃分）以提高覆蓋率。

3.  **忽視非功能性測試**:
    *   **錯誤**: 只專注於功能測試，而忽略效能、安全、可用性、可靠性等非功能性品質，導致系統上線後頻繁出現效能瓶頸或安全漏洞。
    *   **澄清**: 非功能性需求與功能性需求同等重要。應在系統測試階段納入充分的非功能性測試。

4.  **測試環境與生產環境不一致**:
    *   **錯誤**: 測試環境的硬體、軟體配置、資料量或網路條件與生產環境存在顯著差異，導致在測試環境中通過的 Bug 在生產環境中重現 (即「在我的機器上可以運行」)。
    *   **澄清**: 盡可能讓測試環境模擬生產環境，包括作業系統版本、依賴軟體、資料庫大小及網路拓撲等。使用容器化技術 (Docker) 有助於確保環境一致性。

5.  **缺乏自動化回歸測試**:
    *   **錯誤**: 每次發布新版本或修改程式碼後，都需要手動執行大量測試以驗證現有功能未受影響，效率低下且容易出錯。
    *   **澄清**: 應投入資源建構自動化回歸測試套件，並將其整合到 CI/CD 管線中，確保每次程式碼變更都能快速、可靠地驗證。

-----

#### 5.6.2 部署安裝的常見錯誤

1.  **環境配置不當或不一致**:
    *   **錯誤**: 生產環境的配置（如資料庫連線、API 金鑰、記憶體分配、檔案路徑）與測試環境不同，導致應用程式無法正常啟動或運行。
    *   **澄清**: 使用環境變數、配置管理工具或 IaC (Infrastructure as Code) 來管理不同環境的配置，確保一致性並減少人工干預。

2.  **依賴性問題**:
    *   **錯誤**: 部署包中缺少必要的函式庫、驅動程式，或者函式庫版本不匹配，導致應用程式運行時錯誤。
    *   **澄清**: 使用依賴管理工具 (如 Maven, npm, pip) 確保所有依賴都已打包。容器化 (Docker) 是解決此問題的有效方法，因為它將應用程式及其所有依賴都打包在一個可攜帶的單元中。

3.  **權限問題**:
    *   **錯誤**: 部署使用者或應用程式運行使用者缺乏對特定檔案、目錄、資料庫或網路資源的必要權限，導致部署失敗或應用程式無法寫入日誌、存取資料。
    *   **澄清**: 仔細規劃使用者和服務帳戶的權限，遵循最小權限原則，並在部署前驗證所有必要的權限。

4.  **回滾機制缺失或未經測試**:
    *   **錯誤**: 部署失敗後無法快速有效地恢復到舊版本，導致服務長時間中斷。回滾流程從未被演練過。
    *   **澄清**: 任何部署策略都應包含清晰且經過測試的回滾計畫。藍綠部署和金絲雀部署內建了快速回滾的能力。務必在實際部署前演練回滾流程。

5.  **缺乏監控和日誌**:
    *   **錯誤**: 部署後沒有足夠的監控工具來追蹤系統健康狀況，也沒有完善的日誌系統來記錄運行資訊，導致問題發生時難以發現和排查。
    *   **澄清**: 部署的一部分應包括設置應用程式日誌系統 (如 ELK Stack, Splunk) 和監控警報 (如 Prometheus, Grafana, CloudWatch)，以便實時了解系統狀態並及時響應問題。

6.  **過度手動操作**:
    *   **錯誤**: 部署流程中存在大量手動步驟，增加了部署時間、錯誤率和營運人員的壓力。
    *   **澄清**: 最大限度地自動化部署流程，利用 CI/CD 工具將部署過程標準化、重複化和無人化。

-----

### 5.7 小練習（附詳解）

#### 練習一：設計系統功能測試案例

**情境**: 你正在開發一個線上書籍銷售網站。使用者可以搜尋書籍，將書籍加入購物車，並完成結帳。

**任務**: 請為「使用者結帳」功能設計至少三個系統級別的功能測試案例。

**提示**:
1.  考慮不同情境：成功結帳、庫存不足、支付失敗等。
2.  每個案例包含：測試案例 ID、描述、前置條件、測試步驟、預期結果。

-----
**詳解**

**練習一詳解：設計系統功能測試案例**

| 測試案例 ID | 描述                                       | 前置條件                                                              | 測試步驟                                                                                                                                                                                                                                                                                                                                                            | 預期結果                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| :---------- | :----------------------------------------- | :-------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| TC-Checkout-001 | 成功結帳並完成訂單。                         | 使用者已登入，購物車中至少有一件有庫存的商品。                                  | 1. 導航至購物車頁面。<br/>2. 確認商品數量和價格無誤。<br/>3. 點擊「前往結帳」按鈕。<br/>4. 在結帳頁面，填寫有效的收件地址和聯繫方式。<br/>5. 選擇有效的支付方式（如信用卡），並輸入正確的支付資訊。<br/>6. 點擊「確認訂單」或「支付」按鈕。                                                                                                                                | 系統顯示訂單成功的訊息，例如「您的訂單已成功送出！」。<br/>使用者收到訂單確認郵件。<br/>使用者帳戶的訂單歷史中能查看到新的訂單。<br/>購物車被清空。<br/>支付平台顯示交易成功。<br/>相關書籍庫存量減少。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| TC-Checkout-002 | 結帳時商品庫存不足。                       | 使用者已登入，購物車中有一件商品，但該商品的實時庫存量為 0 或低於購物車數量。 | 1. 導航至購物車頁面。<br/>2. 系統檢測到購物車中某商品庫存不足。<br/>3. 嘗試點擊「前往結帳」按鈕。                                                                                                                                                                                                                                                                                  | 系統顯示警告訊息，指示哪些商品庫存不足，並可能阻止使用者繼續結帳，或提示使用者修改購物車數量。<br/>購物車中庫存不足的商品數量可能被自動調整為最大可用庫存量或被移除，並提示使用者。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| TC-Checkout-003 | 支付失敗後系統的處理。                     | 使用者已登入，購物車中至少有一件有庫存的商品。                                  | 1. 導航至購物車頁面。<br/>2. 確認商品數量和價格無誤。<br/>3. 點擊「前往結帳」按鈕。<br/>4. 在結帳頁面，填寫有效的收件地址和聯繫方式。<br/>5. 選擇支付方式（如信用卡），並故意輸入錯誤的支付資訊（例如，錯誤的卡號或過期日期）。<br/>6. 點擊「確認訂單」或「支付」按鈕。                                                                                                                                | 系統顯示支付失敗的錯誤訊息，例如「支付處理失敗，請檢查您的支付資訊」。<br/>使用者停留在結帳頁面，可以修改支付資訊並重新嘗試支付。<br/>購物車中的商品保持不變。<br/>不會生成新的訂單。<br/>（可選）系統可能提示其他支付方式。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| TC-Checkout-004 | 結帳頁面返回購物車後商品狀態不變。           | 使用者已登入，購物車中有多件商品。                                        | 1. 將多件商品加入購物車。<br/>2. 進入購物車頁面。<br/>3. 點擊「前往結帳」按鈕進入結帳頁面。<br/>4. 在結帳頁面，點擊「返回購物車」或瀏覽器的返回按鈕。                                                                                                                                                                                                                            | 系統返回到購物車頁面，購物車中的商品種類、數量和總價應與進入結帳頁面之前保持一致。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

-----

#### 練習二：選擇合適的部署策略

**情境**: 一家新創公司開發了一款即時通訊 App，用戶基數正在快速增長。他們需要為下一個版本（v2.0）進行部署。v2.0 包含了一些核心功能更新和 Bug 修復，希望在部署過程中盡量減少服務中斷，並能及時發現潛在問題。

**任務**: 根據上述情境，建議一種最適合的部署策略，並說明原因。

-----
**詳解**

**練習二詳解：選擇合適的部署策略**

**建議的部署策略**: 金絲雀部署 (Canary Deployment)

**原因說明**:

1.  **最小化服務中斷 (Minimize Downtime)**: 金絲雀部署允許新舊版本同時存在，新版本首先部署到一小部分伺服器或使用者群體。這意味著在部署過程中，大部分用戶仍然使用舊版本服務，因此服務中斷風險極低或幾乎沒有。對於一個「用戶基數快速增長」的「即時通訊 App」而言，服務的連續性至關重要。

2.  **及早發現潛在問題 (Early Problem Detection)**: v2.0 包含「核心功能更新和 Bug 修復」。任何核心功能的修改都可能引入新的 Bug 或產生意想不到的副作用。金絲雀部署可以將新版本的功能和 Bug 修復暴露給一小部分「金絲雀」用戶進行真實環境測試。如果新版本出現問題（例如：崩潰、延遲增加、新 Bug），影響範圍將僅限於這小部分用戶，風險可控。團隊可以根據這小部分用戶的反饋和監控數據，及時發現並修復問題，避免影響所有用戶。

3.  **降低回滾成本和風險 (Reduce Rollback Cost and Risk)**: 如果金絲雀版本出現嚴重問題，只需將流量切回舊版本，回滾過程快速且影響範圍小。這比將新版本一次性推向所有用戶，然後再嘗試回滾的風險要低得多。

**比較與其他策略**:

*   **藍綠部署 (Blue-Green Deployment)**: 也能實現零停機和快速回滾，但需要額外的完整生產環境資源，成本較高。對於新創公司可能資源有限，且金絲雀部署在逐步放量時能提供更細粒度的風險控制，更適合用於核心功能更新。
*   **滾動部署 (Rolling Deployment)**: 也能逐步更新，但如果問題出現，可能已經影響了一定比例的用戶。金絲雀部署能更精準地控制初始受影響用戶的比例。
*   **傳統部署 (Traditional Deployment)**: 通常會有服務中斷，且一旦部署失敗，回滾流程複雜，風險極高，完全不適用於用戶基數快速增長的即時通訊 App。

綜上所述，金絲雀部署能夠在保證服務連續性的同時，有效控制新版本引入的風險，並提供在真實用戶環境中驗證功能的機會，對於這家新創公司來說是最佳選擇。

-----

### 5.8 延伸閱讀/參考 (Further Reading/References)

*   **軟體測試相關**
    *   *Software Testing Fundamentals: Methods and Metrics* by Marnie L. Hutcheson
    *   *Agile Testing: A Practical Guide for Testers and Agile Teams* by Lisa Crispin and Janet Gregory
    *   [ISTQB 官方網站](https://www.istqb.org/) (國際軟體測試認證委員會，提供全球認可的軟體測試證書)

*   **DevOps 與部署相關**
    *   *The DevOps Handbook: How to Create World-Class Agility, Reliability, & Security in Technology Organizations* by Gene Kim, Jez Humble, Patrick Debois, John Willis
    *   *Continuous Delivery: Reliable Software Releases through Build, Test, and Deployment Automation* by Jez Humble and David Farley
    *   [Martin Fowler - Deployment Strategies](https://martinfowler.com/bliki/DeploymentStrategies.html) (知名軟體開發專家對部署策略的深入探討)

*   **容器化與雲端部署**
    *   [Docker 官方文件](https://docs.docker.com/) (學習容器化技術的基礎)
    *   [Kubernetes 官方文件](https://kubernetes.io/docs/) (了解容器編排與管理)
    *   [AWS Lambda 官方文件](https://aws.amazon.com/lambda/features/) (深入了解無服務器計算)

*   **混沌工程**
    *   *Chaos Engineering: Crash Test Your Systems in Production* by Casey Rosenthal, Nora Jones, Russell Miles, Bianca Saleh
    *   [Principles of Chaos Engineering](https://principlesofchaos.org/) (混沌工程的設計原則)