# 4-1 Python 環境的安裝與使用介紹

本章節將引導您了解 Python 環境的安裝過程與基本使用方法。無論您是初學者或希望重新檢視基礎，本章都將提供清晰的指引，確保您能順利建立起自己的 Python 開發環境。

-----

### 1. 核心概念與定義

在開始安裝之前，讓我們先理解一些核心概念，這將有助於您更好地掌握 Python 環境的運作原理。

#### 什麼是「安裝」？

- **核心觀念**：在電腦中部署程式或軟體，使其能夠被系統辨識並執行。對於 Python 而言，這意味著將 Python 解釋器、標準函式庫以及相關工具（如套件管理器 `pip`）複製到您的系統中，並進行必要的設定（例如設定 PATH 環境變數）。
- **例子**：當您在 Windows 上執行 Python 安裝程式，或在 Linux 上使用 `apt install python3` 命令時，就是在進行「安裝」。
- **與相鄰概念的關聯**：安裝是使用的前置步驟，沒有正確的安裝，任何 Python 程式都無法執行。

#### 為什麼需要「環境」？

- **核心觀念**：一個獨立、受控的程式執行空間。在 Python 中，特別是指「虛擬環境」，它能讓不同的專案使用各自獨立的 Python 版本和套件集合，避免版本衝突。
- **例子**：專案 A 需要 `requests` 2.20 版，而專案 B 需要 `requests` 2.25 版。若沒有虛擬環境，直接安裝可能導致其中一個專案無法正常運作。透過虛擬環境，兩個專案可以各自擁有其所需的 `requests` 版本。
- **與相鄰概念的關聯**：環境是為了專案隔離與管理而生，與「套件管理器」緊密相關，因為套件通常安裝在特定的環境中。

#### Python 解釋器 (Python Interpreter)

- **核心觀念**：一個程式，負責讀取並執行您撰寫的 Python 程式碼。它是 Python 語言的核心，將高階的 Python 程式碼轉換為機器可理解的指令。
- **例子**：當您在命令列輸入 `python your_script.py` 時，就是調用了 Python 解釋器來執行 `your_script.py` 這個檔案。
- **與相鄰概念的關聯**：沒有解釋器，Python 程式碼就只是一堆文字。解釋器是所有 Python 工具（如 `pip`、虛擬環境）的基礎。

#### 套件管理器 (Package Manager - pip)

- **核心觀念**：一個用於安裝、升級和移除 Python 套件（也稱函式庫或模組）的工具。`pip` (Pip Installs Packages) 是 Python 官方推薦的套件管理器。
- **例子**：
    - 安裝 `requests` 套件：`pip install requests`
    - 升級 `requests` 套件：`pip install --upgrade requests`
    - 移除 `requests` 套件：`pip uninstall requests`
- **與相鄰概念的關聯**：`pip` 讓您能輕鬆地擴展 Python 的功能，而這些套件通常是安裝在特定的 Python 環境（例如虛擬環境）中。

#### 虛擬環境 (Virtual Environment - venv)

- **核心觀念**：一個獨立的 Python 安裝目錄，包含自己的 Python 解釋器、`pip` 工具以及所有已安裝的套件。它將專案的依賴項與系統全域的 Python 環境隔離開來。
- **例子**：
    1. 建立虛擬環境：`python -m venv my_project_env`
    2. 啟用虛擬環境 (Windows)：`.\my_project_env\Scripts\activate`
    3. 啟用虛擬環境 (macOS/Linux)：`source my_project_env/bin/activate`
    啟用後，命令列前會出現環境名稱，表示您目前正在該環境中操作。
- **與相鄰概念的關聯**：虛擬環境是管理專案依賴的最佳實踐，它依賴於 Python 解釋器來建立，並使用 `pip` 在其內部安裝套件。

-----

### 2. 典型例子：Python 環境安裝與基本使用

本節將帶您一步步安裝 Python，並介紹其基本使用方法，包括套件安裝與虛擬環境的建立。

#### 2.1 安裝 Python 解釋器

由於作業系統的差異，Python 的安裝方式會略有不同。建議始終從 Python 官方網站下載最新穩定版。

##### 步驟：

1.  **前往 Python 官方網站**：
    開啟瀏覽器，訪問 [python.org](https://www.python.org/downloads/)。
2.  **下載適合您作業系統的安裝程式**：
    -   **Windows**：點擊 "Download Python X.Y.Z" 按鈕（X.Y.Z 為版本號），下載 `.exe` 安裝檔。
    -   **macOS**：點擊 "Download Python X.Y.Z" 按鈕，下載 `.pkg` 安裝檔。
    -   **Linux**：Python 通常已預裝。若需特定版本或非預裝，可透過系統的套件管理器（例如 `sudo apt install python3` 或 `sudo dnf install python3`）安裝，或從原始碼編譯。
3.  **執行安裝程式**：
    -   **Windows**：
        -   雙擊下載的 `.exe` 檔案。
        -   **非常重要**：在安裝精靈的第一個畫面，務必勾選 "**Add Python X.Y to PATH**" (將 Python X.Y 加入 PATH)。這會自動將 Python 加入系統環境變數，讓您可以在任何命令列位置執行 Python 指令。
        -   選擇 "Install Now" 進行預設安裝。
    -   **macOS**：
        -   雙擊下載的 `.pkg` 檔案。
        -   依照安裝精靈的指示，一步步完成安裝。macOS 的安裝程式通常會自動處理 PATH 設定。
    -   **Linux (若從原始碼安裝或使用工具)**：
        -   透過套件管理器安裝會自動配置 PATH。
        -   從原始碼編譯需要手動配置 PATH。

#### 2.2 驗證 Python 安裝

安裝完成後，開啟命令列工具（Windows 為 `cmd` 或 PowerShell，macOS/Linux 為 Terminal），輸入以下指令：

```bash
python --version
```

或

```bash
python3 --version
```

您應該會看到類似 `Python 3.10.x` 的輸出，表示 Python 已成功安裝。
接著，驗證 `pip`：

```bash
pip --version
```

或

```bash
pip3 --version
```

同樣，您應該會看到 `pip` 的版本資訊。若顯示「指令找不到」，請檢查您的 PATH 環境變數設定。

#### 2.3 使用 `pip` 安裝套件

一旦 Python 和 `pip` 安裝完成，您就可以開始安裝第三方套件了。

##### 步驟：

1.  **開啟命令列工具**。
2.  **安裝套件**：
    以安裝常用的 `requests` 套件為例，輸入：
    ```bash
    pip install requests
    ```
    如果您有多個 Python 版本或 `pip` 指令遇到問題，可以嘗試指定 `pip3`：
    ```bash
    pip3 install requests
    ```
    執行後，`pip` 會自動從 Python Package Index (PyPI) 下載並安裝 `requests` 及其所有依賴項。
3.  **驗證套件安裝**：
    開啟 Python 互動式解釋器（輸入 `python` 或 `python3`），然後嘗試匯入該套件：
    ```python
    import requests
    print(requests.__version__)
    ```
    如果沒有報錯並顯示版本號，表示套件安裝成功。輸入 `exit()` 離開解釋器。

#### 2.4 建立與使用虛擬環境

強烈建議在每個專案中使用獨立的虛擬環境。

##### 步驟：

1.  **開啟命令列工具**。
2.  **導航到您的專案目錄**：
    假設您的專案目錄是 `my_project`：
    ```bash
    cd my_project
    ```
    如果目錄不存在，請先建立它：
    ```bash
    mkdir my_project
    cd my_project
    ```
3.  **建立虛擬環境**：
    使用 `venv` 模組建立一個名為 `venv` (這是常見的命名，但您可以取任何名稱) 的虛擬環境：
    ```bash
    python -m venv venv
    ```
    這會在您的專案目錄下創建一個名為 `venv` 的資料夾。
4.  **啟用虛擬環境**：
    -   **Windows (Command Prompt / PowerShell)**：
        ```bash
        .\venv\Scripts\activate
        ```
    -   **macOS / Linux (Bash / Zsh)**：
        ```bash
        source venv/bin/activate
        ```
    啟用成功後，您的命令列提示符會顯示虛擬環境的名稱，例如 `(venv) C:\my_project>` 或 `(venv) user@host:~/my_project$`。
5.  **在虛擬環境中安裝套件**：
    當虛擬環境啟用後，您使用 `pip install` 安裝的所有套件都將會安裝到這個虛擬環境中，而不會影響到系統全域的 Python 環境。
    ```bash
    (venv) pip install numpy
    ```
6.  **停用虛擬環境**：
    當您完成專案工作後，可以停用虛擬環境，回到系統全域的 Python 環境：
    ```bash
    (venv) deactivate
    ```
    命令列提示符上的 `(venv)` 會消失。

-----

### 3. 與相鄰概念的關聯

了解 Python 環境安裝與使用的基礎後，我們來看看它與其他相關概念的聯繫。

#### 3.1 不同作業系統的安裝差異

-   **核心觀念**：雖然 Python 本身是跨平台的，但其在不同作業系統上的安裝管理方式有所不同，主要體現在 PATH 設定、預設 Python 版本和系統套件管理器的運用。
-   **關聯**：
    -   **Windows**：通常使用官方安裝程式，關鍵是勾選 "Add Python to PATH"。
    -   **macOS**：預設可能帶有舊版 Python 2。建議安裝最新 Python 3，並留意 `python` 和 `python3` 指令的區別。
    -   **Linux**：常透過 `apt` (Debian/Ubuntu) 或 `dnf`/`yum` (Fedora/CentOS) 等系統套件管理器安裝，這會自動處理 PATH。
-   **意義**：理解這些差異有助於在不同環境下快速排查問題，並選擇最合適的安裝方式。

#### 3.2 整合開發環境 (IDE) 與文字編輯器

-   **核心觀念**：雖然您可以使用任何文字編輯器編寫 Python 程式碼，但整合開發環境 (IDE) 或帶有擴充功能的進階文字編輯器能提供更豐富的功能，例如程式碼自動完成、偵錯、語法檢查等。
-   **關聯**：
    -   **Python 環境**：IDE 和編輯器需要知道您的 Python 解釋器在哪裡，以及您正在使用哪個虛擬環境，以便提供精確的輔助。
    -   **常見例子**：
        -   **VS Code**：輕量級但功能強大，透過安裝 Python 擴充功能，可以輕鬆選擇和切換虛擬環境。
        -   **PyCharm**：專為 Python 開發設計的強大 IDE，能深度整合虛擬環境、偵錯工具和版本控制。
        -   **Jupyter Notebook/Lab**：特別適合資料科學和互動式開發，每個 Notebook 都可以連結到特定的 Python kernel (虛擬環境)。
-   **意義**：IDE 和編輯器是開發效率的關鍵，它們是 Python 環境的「前端介面」，讓您更舒適地編寫和管理程式碼。

#### 3.3 版本控制系統 (例如 Git)

-   **核心觀念**：Git 是一個分散式版本控制系統，用於追蹤程式碼的變更，協同合作，並輕鬆回溯到歷史版本。
-   **關聯**：
    -   **Python 專案**：在管理 Python 專案時，您會將所有程式碼、腳本以及專案配置（例如 `requirements.txt`，列出專案所需套件）納入 Git 版本控制。
    -   **虛擬環境**：虛擬環境本身（即 `venv` 資料夾）通常**不**會被納入 Git 版本控制，因為它包含了許多環境特有的檔案，且可以隨時重新生成。取而代之的是，您會將 `requirements.txt` 檔案加入 Git，以便其他開發者或您自己在新的機器上重建相同的虛擬環境。
-   **意義**：Git 與 Python 環境共同構成了現代軟體開發的基礎，確保程式碼的可追溯性、團隊協作的順暢性以及環境的可重複性。

-----

### 4. 進階內容：更高效的環境管理

雖然 `venv` 是 Python 內建且簡單易用的虛擬環境工具，但還有一些更進階的工具提供更強大的功能。

#### 4.1 Conda (Anaconda/Miniconda)

-   **核心觀念**：Conda 是一個開源的套件、依賴和環境管理器，最初為 Python 專案設計，但現在支援多種語言。它不僅能管理 Python 套件，還能管理非 Python 函式庫，並且能輕鬆切換不同 Python 版本。
-   **優點**：
    -   跨平台，支援 Windows, macOS, Linux。
    -   能夠管理 Python 本身的不同版本，並建立不同版本的環境。
    -   適合資料科學領域，許多科學計算套件（如 NumPy, SciPy）針對 Conda 有優化。
-   **關聯**：Conda 可以完全取代 `venv` 和 `pip`，提供一套完整的環境管理解決方案。對於需要管理多個 Python 版本或複雜非 Python 依賴的專案非常有用。

#### 4.2 pipenv 與 Poetry

-   **核心觀念**：`pipenv` 和 `Poetry` 是更高層次的 Python 依賴管理工具，旨在改進 `pip` 和 `venv` 的組合使用體驗。它們提供單一指令來管理虛擬環境、安裝套件和生成鎖定檔案（lock file），以確保不同環境下的依賴完全一致。
-   **優點**：
    -   自動管理虛擬環境，無需手動建立和啟用。
    -   使用鎖定檔案（`Pipfile.lock` 或 `poetry.lock`）來精確記錄所有套件及其子依賴的版本，確保可重複性。
    -   提供更簡潔的依賴聲明方式 (`Pipfile` 或 `pyproject.toml`)。
-   **關聯**：這些工具建立在 `pip` 和 `venv` 的基礎之上，但提供了更自動化和一致性的管理流程，特別適合大型專案或團隊協作。

-----

### 5. 常見錯誤與澄清

在 Python 環境安裝與使用過程中，新手常會遇到以下問題：

#### 5.1 PATH 環境變數問題

-   **錯誤現象**：在命令列輸入 `python` 或 `pip` 後，顯示「'python' 不是內部或外部命令、可執行的程式或批次檔」或「command not found」。
-   **澄清**：這表示系統找不到 Python 解釋器或 `pip` 的執行路徑。
    -   **解決方案**：
        1.  **Windows**：在安裝 Python 時，務必勾選 "Add Python X.Y to PATH"。如果已經安裝但忘記勾選，可以重新執行安裝程式選擇「Modify」，或手動將 Python 安裝目錄下的 `Scripts` 資料夾（例如 `C:\Users\YourUser\AppData\Local\Programs\Python\Python39\Scripts` 和 `C:\Users\YourUser\AppData\Local\Programs\Python\Python39`）添加到系統 PATH 環境變數中。
        2.  **macOS/Linux**：確認 `/usr/local/bin` 或 `~/.bash_profile` (或 `~/.zshrc`) 中包含 Python 的路徑。如果使用 Homebrew 或 `pyenv` 安裝，請按照其指示配置 shell 環境。

#### 5.2 `pip` 與多個 Python 版本

-   **錯誤現象**：安裝套件後，在腳本中卻匯入失敗，或意外地將套件安裝到了錯誤的 Python 版本。
-   **澄清**：如果您的系統中安裝了多個 Python 版本（例如 Python 2 和 Python 3），`pip` 可能會連結到錯誤的版本。
    -   **解決方案**：
        1.  **明確指定版本**：使用 `python3 -m pip install package_name` 或 `pip3 install package_name` 來確保套件安裝到 Python 3 環境。
        2.  **優先使用虛擬環境**：在虛擬環境中，`pip` 指令將自動指向該環境的 Python 版本，避免了版本混淆。

#### 5.3 虛擬環境未啟用卻安裝套件

-   **錯誤現象**：您在專案目錄下建立了虛擬環境，但直接使用 `pip install` 安裝套件，結果套件被安裝到了系統全域環境，而不是虛擬環境。
-   **澄清**：建立虛擬環境後，您**必須**先啟用它，然後再使用 `pip`。未啟用虛擬環境時，您使用的 `pip` 仍是系統全域的 `pip`。
    -   **解決方案**：
        1.  **啟用虛擬環境**：
            -   Windows：`.\venv\Scripts\activate`
            -   macOS/Linux：`source venv/bin/activate`
        2.  **確認提示符**：確認命令列提示符前顯示 `(venv)` 字樣，再執行 `pip install`。

#### 5.4 權限問題

-   **錯誤現象**：在安裝套件時，出現 `Permission denied` 錯誤。
-   **澄清**：這通常發生在嘗試將套件安裝到系統保護的目錄（例如 `/usr/local/lib/python3.x/site-packages`）時，而您沒有足夠的權限。
    -   **解決方案**：
        1.  **使用虛擬環境**：這是最佳方案，因為虛擬環境是建立在使用者可寫入的目錄中，無需特殊權限。
        2.  **不要使用 `sudo pip install` (除非您真的知道在做什麼)**：這會使用 root 權限安裝套件到系統全域，可能導致系統 Python 環境混亂。除非是安裝特定系統級工具，否則應避免。
        3.  **單純為個人使用**：若確實不想使用虛擬環境，且僅為個人使用者安裝，可以使用 `pip install --user package_name`，這會將套件安裝到您的使用者目錄下。

-----

### 6. 小練習（附詳解）

#### 小練習 1: 安裝與驗證 `requests` 套件

**目標**：在一個新的專案目錄中建立虛擬環境，安裝 `requests` 套件，並撰寫一個簡單的 Python 腳本來驗證其功能。

##### 步驟：

1.  **建立專案目錄並進入**：
    ```bash
    mkdir my_web_project
    cd my_web_project
    ```
2.  **建立並啟用虛擬環境**：
    ```bash
    python -m venv env_web
    # Windows:
    .\env_web\Scripts\activate
    # macOS/Linux:
    source env_web/bin/activate
    ```
3.  **在虛擬環境中安裝 `requests` 套件**：
    ```bash
    (env_web) pip install requests
    ```
    （請確保命令列提示符前有 `(env_web)` 字樣）
4.  **撰寫一個 Python 腳本**：
    在 `my_web_project` 目錄中，建立一個名為 `get_url.py` 的檔案，並輸入以下內容：
    ```python
    # get_url.py
    import requests

    try:
        response = requests.get('https://www.example.com')
        response.raise_for_status() # 如果請求失敗，拋出異常
        print(f"成功取得網頁內容！狀態碼: {response.status_code}")
        print("部分內容預覽:")
        print(response.text[:200]) # 顯示前200個字元
    except requests.exceptions.RequestException as e:
        print(f"請求失敗: {e}")
    ```
5.  **執行腳本並驗證**：
    ```bash
    (env_web) python get_url.py
    ```
    您應該會看到成功取得 `https://www.example.com` 內容的訊息。
6.  **停用虛擬環境**：
    ```bash
    (env_web) deactivate
    ```

-----

#### 小練習 2: 建立虛擬環境並管理套件列表

**目標**：為一個新的專案建立虛擬環境，安裝多個套件，並將專案依賴項輸出到 `requirements.txt` 檔案，最後演示如何在另一個環境中安裝這些依賴。

##### 步驟：

1.  **建立專案目錄並進入**：
    ```bash
    mkdir my_data_project
    cd my_data_project
    ```
2.  **建立並啟用虛擬環境**：
    ```bash
    python -m venv data_env
    # Windows:
    .\data_env\Scripts\activate
    # macOS/Linux:
    source data_env/bin/activate
    ```
3.  **在虛擬環境中安裝多個套件**：
    我們將安裝 `pandas` 和 `matplotlib` 這兩個資料分析與視覺化常用套件。
    ```bash
    (data_env) pip install pandas matplotlib
    ```
4.  **將已安裝套件列表輸出到 `requirements.txt`**：
    ```bash
    (data_env) pip freeze > requirements.txt
    ```
    這會在 `my_data_project` 目錄下生成一個 `requirements.txt` 檔案，其中包含了 `pandas` 和 `matplotlib` 以及它們所有的子依賴和精確版本號。
5.  **檢視 `requirements.txt` 內容**：
    打開 `requirements.txt` 檔案，您會看到類似以下的內容（版本號可能不同）：
    ```
    fonttools==4.39.3
    kiwisolver==1.4.5
    matplotlib==3.8.4
    numpy==1.26.4
    packaging==23.2
    pandas==2.2.2
    Pillow==10.3.0
    pyparsing==3.1.2
    python-dateutil==2.9.0.post0
    pytz==2024.1
    setuptools==69.5.1
    six==1.17.0
    tzdata==2024.1
    ```
6.  **模擬在另一台機器上重建環境**：
    先停用當前虛擬環境，並創建一個新的「模擬」專案目錄。
    ```bash
    (data_env) deactivate
    cd ..
    mkdir new_machine_project
    cp my_data_project/requirements.txt new_machine_project/
    cd new_machine_project
    ```
7.  **在新環境中建立虛擬環境並安裝依賴**：
    ```bash
    python -m venv new_data_env
    # Windows:
    .\new_data_env\Scripts\activate
    # macOS/Linux:
    source new_data_env/bin/activate
    (new_data_env) pip install -r requirements.txt
    ```
    這將根據 `requirements.txt` 檔案中列出的所有套件及其精確版本進行安裝。
8.  **驗證新環境中的套件**：
    ```bash
    (new_data_env) python
    >>> import pandas
    >>> import matplotlib
    >>> print(pandas.__version__)
    >>> print(matplotlib.__version__)
    >>> exit()
    ```
    如果沒有報錯並顯示正確的版本號，則表示您已成功透過 `requirements.txt` 重建了相同的開發環境。
9.  **停用虛擬環境並清理**：
    ```bash
    (new_data_env) deactivate
    cd ..
    rm -rf my_data_project new_machine_project # 僅在您確認無誤後執行
    ```

-----

### 7. 延伸閱讀與參考

-   **Python 官方文件 - 安裝 Python**：
    [https://docs.python.org/3/using/windows.html](https://docs.python.org/3/using/windows.html) (Windows)
    [https://docs.python.org/3/using/mac.html](https://docs.python.org/3/using/mac.html) (macOS)
    [https://docs.python.org/3/using/unix.html](https://docs.python.org/3/using/unix.html) (Linux/Unix)
-   **Python 官方文件 - 虛擬環境與套件**：
    [https://docs.python.org/3/tutorial/venv.html](https://docs.python.org/3/tutorial/venv.html)
-   **pip 官方文件**：
    [https://pip.pypa.io/en/stable/](https://pip.pypa.io/en/stable/)
-   **VS Code - Python 擴充功能**：
    [https://code.visualstudio.com/docs/python/python-tutorial](https://code.visualstudio.com/docs/python/python-tutorial)
-   **Anaconda/Miniconda 官方網站**：
    [https://www.anaconda.com/products/individual](https://www.anaconda.com/products/individual)
-   **Pipenv 官方網站**：
    [https://pipenv.pypa.io/en/latest/](https://pipenv.pypa.io/en/latest/)
-   **Poetry 官方網站**：
    [https://python-poetry.org/](https://python-poetry.org/)